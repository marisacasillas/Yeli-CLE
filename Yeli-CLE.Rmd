---
title             : "Early language experience in a Papuan community"
shorttitle        : "Language experience on Rossel Island"

author: 
  - name          : "Marisa Casillas"
    affiliation   : "1"
    corresponding : yes    # Define only one corresponding author
    address       : "P.O. Box 310, 6500 AH Nijmegen, The Netherlands"
    email         : "Marisa.Casillas@mpi.nl"
  - name          : "Penelope Brown"
    affiliation   : "1"
  - name          : "Stephen C. Levinson"
    affiliation   : "1"

affiliation:
  - id            : "1"
    institution   : "Max Planck Institute for Psycholinguistics"

#author_note: |
#  Add complete departmental affiliations for each author here. Each new line herein must be indented, like this line.

abstract: |
  Daylong recordings capture many patterns within children's typical language experience, including how linguistic input rate varies depending on child age, time of day, and number of speakers present. We used daylong recordings to investigate how much speech is available to young children (0;0--3;0) on Rossel Island, Papua New Guinea; a community where prior ethnographic study demonstrated face-to-face contingency-seeking interactional styles with infants and young children. We found that the patterns of children's daylong language experience were somewhat different from that seen in prior ethnographic work. Children were infrequently directly addressed and their linguistic input rates were primarily affected by circumstantial aspects of everyday life (e.g., the presence of other speakers). We discuss the different insights afforded by these approaches in a comparative cross-cultural framework and how the daylong and ethnographic findings together shed light on the question of how minimal direct linguistic input can support first language development.

keywords          : "Child-directed speech, linguistic input, non-WEIRD, vocal maturity, interaction, Papuan"
wordcount         : "11648 (9927 in the main text, excluding references)"

bibliography      : ["Yeli-CLE.bib"]

figsintext        : yes
figurelist        : no
tablelist         : no
footnotelist      : no
lineno            : yes
mask              : no

class             : "man"
output            : papaja::apa6_word #apa6_pdf or apa6_word
---

```{r load_packages, include=FALSE, echo=FALSE, warning=FALSE}
library(papaja)
library(ggplot2)
library(tidyverse)
library(viridis)
library(grid)
library(gridExtra)
library(lme4)
library(glmmTMB)
library(DHARMa)
library(bbmle)
library(broom.mixed)
library(lubridate)
source("0-Helper.R")
```

```{r analysis_presets, include=FALSE}
options(scipen=999)
data.path <- "transcripts/anon/" # text files exported from ELAN
metadata.path <- "metadata/"
plot.path <- "plots/" # output plots
shiny.input.path <- "shiny_input/"
shiny.input.img.path <- "www/"
ptcp.info.file <- paste0(metadata.path, "recording-info.csv")
samplelabels <- c("High activity  ", "Random  ")
col.sample.bu <- list(
  scale_fill_manual(labels=samplelabels, values=viridis(2)),
  scale_color_manual(labels=samplelabels, values=viridis(2)))
col.sample.bu3 <- list(
  scale_fill_manual(labels=samplelabels, values=viridis(3)),
  scale_color_manual(labels=samplelabels, values=viridis(3)))
rand.sample.dur <- 2.5
ext.sample.dur <- 5
peak.sample.dur <- 1
p.levels <- c(0, 0.001, 0.01)
pval.display <- function(p.est) {
  level <- findInterval(p.est, p.levels)
  p.string <- ifelse(level == 3, paste0("= ", round(p.est, 2)),
    ifelse(level == 2, "< 0.01", "< 0.001"))
  return(p.string)
}

```

# Introduction {#intro}

In their first few years of life, children hear an extraordinary amount of language. The sum of this experience with language (their "input") is the basis for their lexical, grammatical, and sociolinguistic development. Much developmental language research focuses on the value of child-directed speech (CDS) **in particular** as a tailored source of linguistic input that can boost lexical and syntactic development [@bates1997inseparability; @brinchmann2019direct; @frankIPvariability; @hart1995meaningful; @hoff2003specificity; @huttenlocher2010sources; @lieven1997lexically; @marchman2004language; @shneidman2012language; @weisleder2013talking]. However, we also know that **children's** language environments---e.g., who is around and talking about what to whom---vary dramatically within and across families, **and** children in some communities **hear** very little directed talk **without any** apparent delays in their linguistic development [@brown2011cultural; @brown2014interactional; @brown2014language; @casillas2019early; @gaskins2006cultural; @ochs1984language]. **A key puzzle for developmental language science** is then unmasking how the human cognitive toolkit for language learning can flexibly adapt to the variable contexts under which it successfully occurs**, for example, when CDS is infrequent, comes primarily from other children, or mostly occurs during a small handful of activities (REFS; Shneidman, Ochs, Brown, TseltalCasillas, Wittebolle). Resolving this puzzle requires us find ways to track the distribution and characteristics of linguistic input over multiple interactional contexts, across developmental time, between families, and across different cultural groups.**

**In what follows we explore how two major social factors---ideological stance toward child-directed speech and situational features of everyday life---impact children's linguistic environments. We build a case for testing both sources of variation using clips sampled from recordings of whole waking days at home. We then use this approach to report on the language environments of children under 3;0 in one child-centric subsistence farming society (Rossel Island, Papua New Guinea), and compare the findings to a parallel set of results of another subsistence farming society, this one non-child-centric (Tenejapa, Mexico).**

## Ideological and situational variation in CDS

**Caregivers' personal and cultural notions about how children should develop as members of the broader language community influence the prevalence and format of child-directed talk [REFS]. For example, extensive ethnographic research among multiple, distinct Mayan communities of Southern Mexico and Guatemala has forged a consistent view of childrearing and child-directed speech: adult caregivers shape infants' and young children's worlds such that  children learn to attend to what is going on around them rather than expecting to be the center of attention [e.g., @brown2011cultural; @brown2014interactional; @deleon2011language; @gaskins2000childrens; @pye1986quiche; @rogoff2003firsthand]. These ethnographic findings lay out an extensive ideology of caregiving, including a number of component attitudes (e.g., infants as inadequate conversational partners) leading us to predict that, on average, typically developing Mayan children hear little speech directed to them during their days at home. Indeed, using data from daylong recordings of children under age 3;0, Casillas and colleagues [-@casillas2019early] found that the Tseltal Mayan children in their sample heard an average of 3.6 minutes per hour of speech directed to them---around one third of the current estimate for North American English [REFS]---yet hit established Western benchmarks for the onset of single- and multi-word utterances [see also REFS-cychosz]. While this finding supported the prediction based on different Mayan vs. North American attitudes regarding child-directed talk, any direct comparison between the two contexts is critically confounded: the arrangement of everyday life is highly different between the subsistence farming, rural Mayan sample and (sub)urban middle-class post-industrial North American sample.**

**Children's broader linguistic input also varies depending on the social organization of everyday life, which shapes the circumstances for interaction over the course of the day. For example, prior analyses of daylong recordings in both North American [REFS] and Tseltal Mayan [REFS] contexts suggests that different activities over the course of the day impact the rate at which children hear child-directed speech [REFS; see also Bergelson, Tamis-LeMonda]. In their [-@casillas2019early] study, Casillas and colleagues find a different patten of input rate fluctuation over the course of the day than that previously reported for North American data [REFS], suggesting that the difference may derive from the daily arc associated with growing up in a multi-generational, subsistence farming household. The subsistence farming lifestyle in this context near-guarantees multiple nearby adult and child speakers in the mornings and late afternoons, usually gathered in communal areas for eating, separated by longer, relatively quiet periods of work and rest [REFS; see also gaskins; follow references on inappropriateness of play]. In fact, differences in the organization of everyday life between the Tseltal and North American communities studied previously may explain many of the differences in children's daylong input patterns [REFS]. If so, daylong recordings may be best suited to capturing lifestyle differences shaping circumstantial aspects of home language use across communities, while not necessarily capturing differences in caregiver notions about child language development.**

**In the current study, we investigate how well daylong recordings capture ideological (as opposed to social organizational) variation in linguistic input by examining linguistic input patterns in a community with a broadly similar subsistence farming lifestyle to the Tseltal community reported above but, crucially, with an ethnographically documented inclination _toward_ high-engagement social interaction with infants. If patterns of child-directed speech in this community are similar to those reported for North American English, the data would support the use of daylong recordings for capturing ideologically-driven differences in input cross-culturally. If, instead, child-directed speech patterns are more similar to that of the Tseltal community, the data would support the use of daylong recordings for capturing _lifestyle-driven_ differences in input cross-culturally; specifically subsistence farming vs. post-industrial settings.**

<!--here mention peaks and vocmat-->

## Tracking linguistic input in diverse communities

Traditionally, **developmentalists have** relied on short cross-sectional or longitudinal video recordings of caregiver-child interaction, at home or in the lab, to get a grasp on what kinds of language children typically hear. This approach has been fruitful in teasing out individual and group-based differences in interactional behaviors [@cartmill2013quality; @hoff2003specificity; @hurtado2008does; @rowe2008child]**, yielding rich insights into the moment-to-moment characteristics of interaction in both over- and understudied populations [REFS]. Researchers employing this short-recording method use their community knowledge (via membership or ethnographic study) to ensure that the sampled interactional contexts are representative of typical childrearing attitudes and practices [REFS]. That said, the short-recording format, and the anchoring effect of a standalone lens/microphone on the interactants makes it almost impossible to capture the full variety of language activities children encounter, e.g., when they are in free motion (e.g., talking while running around) or situations not readily accessible to others (e.g., pre-sleep routines).**

Daylong recordings** offer an alternative to the short-recording method. They** are typically made from a single audio recorder worn by the target child at home, unleashing interactants from the constraint of being within direct view of a camera, and thereby allowing them to more freely navigate their environment for multiple hours at a time **[@casillas2019stepbystep]. Advances in speech technology increasingly allow researchers to use automated methods to reliably identify target child and female adult speech from thousands of hours of data with just a few hours of processing time, robustly, and across a growing number of languages and settings [REFS, ACLEW; @xu2009reliability]. Well-documented methods for also systematically adding _manual_ annotations to sub-parts of these recordings are rapidly expanding, building on past work with short recordings [REFS;@cychoszURcanonical, @casillas2019stepbystep, @casillas2017DAS]. Using daylong recordings, researchers can document both the ebbs _and_ the flows in everyday language activity, giving critical insignt into how linguistic input varies across speakers, activities, and more. Because these recordings span long periods or even whole waking days, they release reseachers from choosing individual interactional contexts, and can therefore be collected using similar procedures across diverse linguistic and cultural settings [@bergelsonIPbsl; @cychoszURcanonical].**

**This novel recording method unfortunately also introduces novel risks (@cychoszURlongform), among which is misrepresentation of understudied communities. If the research team is not sufficiently familiar with the community under study and bases their conclusions solely on automatically extracted basic language measures, it risks mischaracterizing how language is used and learned in that community. The only real solution to this issue is for developmental science to promote direct scientific interactions with representatives in more diverse communities. However, in the short term, an important first step is to simply investigate which aspects of cross-cultural variation in the child language environment are actually captured in daylong recordings.**

## Predictions

<!--here mention peaks-ideology link again; shorten overall-->

We analyze daylong recordings from Rossel Island, Papua New Guinea (PNG), a small-scale indigenous community in which prior ethnographic work [@brownIPchildrearing] has painted a clear picture of early caregiver-child interaction: child-centric, face-to-face interaction from the first days of infancy. Based on those findings, **which we detail** below, we made four predictions about children's speech environments. First, we predicted that children on Rossel Island would hear frequent child-directed speech from a wide variety of caregiver types throughout the day. Second, given that infants are frequently passed between caregivers, we expected to see weaker effects of the subsistence farming schedule on Rossel children's input than has been found in other subsistence farming societies like the Tseltal Mayans [@casillas2019early]. Third, as children get older, we expected to see a large increase in the proportion of child-directed speech coming from other children, as seen in the Yucatec Mayan community [@shneidman2012language]. Fourth, we expected a large quantity of other-directed speech around them, given the large number of family numbers typically present.

We also expected to replicate three language environment patterns that have consistently emerged across Western and non-Western daylong recording studies (i.e., not specific to Rossel Island): (a) no increase in child-directed speech rate across age, (b) a decrease in other-directed speech rate across age, and (c) a non-uniform, bursty distribution of directed talk over the day [@abney2017time; @bergelsoncasillas2019what; @casillas2019early; @scaffIPlanguage].

In what follows we will review the ethnographic work done in this community previously, describe our methods for following up on these findings with daylong recordings, present the current findings, and discuss the differences that arose. All methods for annotation and analysis in this study closely follow those reported elsewhere for Tseltal Mayan children’s speech environments [@casillas2019early].


# Method {#methods}
## Corpus {#methods-dataset}
The participants in this study live in a collection of small hamlets on north-eastern Rossel Island, approximately 250 nautical miles off the southern tip of mainland Papua New Guinea with only intermittent access to and contact with the outside world. The traditional language of Rossel Island is Yélî Dnye, an isolate (Papuan), which features a phonological inventory and set of grammatical features unlike any other in the (predominantly Austronesian) languages of the region. The islanders are subsistence farmers, cultivating taro, sweet potato, manioc, yam, coconut, and more for their daily subsistence, with protein coming from fishing and (occasionally) slaughtering pigs or local animals. Children often forage independently for shellfish and wild nuts, extra sources of protein. Most children on Rossel Island grow up speaking Yélî Dnye monolingually at home, learning English as a second language once they begin school around age 7. Children grow up in patrilocal household clusters (i.e., their family and their father's brothers' families), usually arranged such that there is some shared open space between households. 

During their waking hours, infants are typically carried in a caregiver's arms as they go about daily activities. Infants, even very young ones, are frequently passed between different family members (male and female, young and elderly) throughout the day, returning to the mother to suckle when hungry. The arc of a typical day for an infant might include waking, being dressed and fed, then a mix of (a) spending time with nearby adults or older children as they walk around socializing and completing tasks with others and (b) more feeding, perhaps followed by short bouts of sleep in the late morning and afternoon, usually with the mother. Sometimes children are also taken to the gardens after the morning meal. Afternoon meals are cooked from around 15:00 onward, with another eating and more socializing before resting for the night. Starting around age two or three, children spend much of their time in large, independent child playgroups (10+ cousins and neighbors) who freely travel near and around the village searching for nuts and fruits, bathing in nearby rivers, and engaging in group games (e.g., tag, pretend play, etc.).

Interaction with infants and young children on Rossel Island is initiated by women, men, girls, and boys alike in a face-to-face, contingency-seeking, and affect-laden style [@brown2011cultural; @brownIPchildrearing]. Children are considered a shared responsibility, but also a source of joy and entertainment for the wider network of caregivers in their community. In her prior ethnographic work, Brown details some ways in which interactants make bids for joint attention and act as if the infant can understand what is being said [@brown2011cultural]. Infants pick up on this pattern of caregiving, initiating interactions with others twice as frequently as Tseltal children, who are encouraged instead to be observers of the interactions going on around them [@brown2011cultural]. Brown and Casillas [-@brownIPchildrearing] document how Rossel caregivers encourage early independence in their children, observing their autonomy in choosing what to do, wear, eat, and say while finding other ways to promote pro-social behavior (e.g., praise). Overall, Rossel Island could be characterized as a child-centered language environment [@ochs1984language; but see @brownIPchildrearing], in which children, even very young ones, are considered interactional and conversational partners whose interests are often allowed to shape the topic and direction of conversation.

The data presented here come from the Rossel Island subset of the OMITTED-FOR-REVIEW><!-- Casillas HomeBank Corpus [@Casillas-HB]-->, a collection of raw daylong recordings and supplementary data from over 100 children under age four growing up on Rossel Island OMITTED-FOR-REVIEW<!-- and in the Tseltal Mayan community described elsewhere [@casillas2019early]-->. The Rossel Island subcorpus was collected in 2016 and includes daylong audio recordings and experimental data from 57 children born to 43 mothers. These children had 0--2 younger siblings (mean = 0.36; median = 0) and 0--5 older siblings (mean = 2; median = 2); most participating caregivers were on the younger end of those in the community, though two primary caregiver pairs were their child’s biological grandparents (mean = 33.9 years; median = 32; range = 24--70 and fathers: mean = 35.6; median = 34; range = 24---57). Based on available demographic data for 40 of the biological mothers we estimate that mothers are typically 21.4 years old when they give birth to their first child (median = 21.5; range = 12--30). On the basis of demographic data for 34 of those mothers, we estimate an average inter-child interval of 2.8 years (median = 2.6; range = 1.75--5.2). Household size, defined here as the number of people sharing kitchen and sleeping areas on a daily basis, ranged between 3 and 12 (mean = 7; median = 7). Households are clustered into small patrilocal hamlets which form a wider group of communal caregivers and playmates. The hamlets themselves are clustered together into patches of more distantly related patrilocal residents. The average hamlet in our corpus comprises 5.8 households (median = 5; range = 3--11); the typical household in our dataset has 2 children under age seven (i.e., not yet attending school) and 2 adults, leading us to estimate that there are around 10 young children and 10 adults present within a hamlet throughout the day. This estimate does not include visitors to the target child's hamlet or relatives the target child encounters while visiting others. Therefore, while 24.6% of the target children in our corpus are first born to their mothers, these children are incorporated into a larger pool of young children whose care is divided among numerous caregivers. Among our participating families, most mothers had finished their education at one of the island's schools (6 years of education = 32.6%; 8 years of education = 37.2%)^[Local schools include elementary (~3 years; ages ~7--10) and primary (~6 years; ages ~10--16) education. Subsequent education is not locally available and students pursuing this route must find accommodations on the nearby island Misima or on mainland PNG.], with about a quarter having attended secondary school off the island (10 years of education = 25.6%; 12 years of education = 2%). Only one mother had less than six years of education. Similarly, most fathers had finished their education at one of the island's schools (6 years of education = 44.2%; 8 years of education = 20.9%) or at an off-island secondary school (10 years of education = 27.9%), with only 7% having less than six years of education. Note that in [Table 1](#tab1) we use a different set of educational levels than is used on the island so that we can more easily compare the present sample to that used in @casillas2019early. To our knowledge at the time of recording, all but two children were typically developing; one showed signs of significant language delay and one showed signs of multiple developmental delay (motor, language, intellectual). Both children's delays were consistently observed in follow-up trips in 2018 and 2019. Their recordings are not included in the analyses reported below.

Dates of birth for children were initially collected via parent report. We were able to verify the majority of birth dates using the records at the island health clinic. Because not all mothers give birth at the clinic and because dates are written by hand, some births are not recorded, are inaccurately recorded, or otherwise significantly diverge from what the parents report. In these cases we gathered information from as many sources as possible and followed up with the families, often using the dates of neighboring children born around the same time to determine the correct date.

The data we present come from 7--9-hour recordings of a waking day at home. Children wore the recording device: an elastic vest containing a small stereo audio recorder (Olympus WS-832 or WS-853) and a miniature camera that captured photos of the child's frontal view at a fixed interval (every 15 seconds; Narrative Clip 1). The camera was outfitted with a fisheye lens that allowed us to capture 180 degrees of the child's frontal view. This photo technique increases the ease and reliability of transcription and annotation. However, because the camera and recorder are separate devices, we had to synchronize them manually. We used an external wristwatch to record the current time at start of recording on each device individually, with accuracy down to the second (photographed by the camera and spoken into the recorder). The camera's software timestamps each image file such that we can calculate the number of seconds that have elapsed between photos. These timestamps were used with the cross-device time synchronization cue to create photo-linked audio files of each recording, which we then formatted as video files (see URL_MASKED_FOR_REVIEW<!--https://github.com/marisacasillas/Weave--> for scripts). The informed consent process used with participants, as well as data collection and storage, were conducted in accordance with ethical guidelines approved by the Radboud University Social Sciences Ethics Committee.

```{r prepare_data, message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
# Read in annotation files
files <- list.files(path=data.path,pattern="*.txt")
all.data <- data.frame()
for (i in 1:length(files)) {
  newfile <- read_csv(paste0(data.path, files[i]),
                      col_types = cols(val = col_character()))
  newfile$aclew_child_id <- unlist(strsplit(files[i], '\\.'))[1]
  all.data <- rbind(all.data, newfile)
}
all.data$row <- c(1:nrow(all.data))

# Read in supplementary data
ptcp.info <- read_csv(ptcp.info.file, col_types = cols())
ptcp.info$aclew_child_id <- as.character(ptcp.info$aclew_child_id)

# Extract and convert start time of each sample
rec.time.info <- ptcp.info %>%
  select(aclew_child_id, start_of_wav, length_of_wav) %>%
  mutate(
    start.hh = substr(start_of_wav, 1, 2),
    start.mm = substr(start_of_wav, 4, 5),
    start.ss = substr(start_of_wav, 7, 8),
    start_of_wav.ms = period_to_seconds(hms(start_of_wav))*1000,
    stop_of_wav.ms = start_of_wav.ms + length_of_wav*1000,
    stop_of_wav = paste(
      str_pad(hour(seconds_to_period(
        stop_of_wav.ms/1000)), 2, "left", pad = "0"),
      str_pad(minute(seconds_to_period(
        stop_of_wav.ms/1000)), 2, "left", pad = "0"),
      str_pad(second(seconds_to_period(
        stop_of_wav.ms/1000)), 2, "left", pad = "0"), sep = ":"),
    length_of_wav.ms = length_of_wav*1000) %>%
  rename(length_of_wav.s = length_of_wav) %>%
  select(aclew_child_id,
         start_of_wav, stop_of_wav, length_of_wav.s,
         start_of_wav.ms, stop_of_wav.ms, length_of_wav.ms,
         start.hh, start.mm, start.ss)

seg.info <- filter(all.data, tier == "code") %>%
  select(-tier, -speaker, -row) %>%
  left_join(rec.time.info) %>%
  mutate(
    start.ms = start_of_wav.ms + start,
    start.sec = start.ms/1000,
    start.hhmmss = paste(
      str_pad(hour(seconds_to_period(start.sec)),
        2, "left", pad = "0"),
      str_pad(minute(seconds_to_period(start.sec)),
        2, "left", pad = "0"),
      str_pad(second(seconds_to_period(start.sec)), 2,
        "left", pad = "0"), sep = ":"),
    start.hr = start.ms/3600000)

# Add mean and sd values for participant-level predictors to ptcp.info
ptcp.info <- ptcp.info %>%
  mutate(
    tchiyr.m = mean(age_mo_round),
    motyr.m = mean(mat_age),
    nsb.m = mean(number_older_sibs),
    hsz.m = mean(household_size),
    tchiyr.sd = sd(age_mo_round),
    motyr.sd = sd(mat_age),
    nsb.sd = sd(number_older_sibs),
    hsz.sd = sd(household_size)
    )

# Merge participant and segment info to the main data table
codes <- filter(all.data, tier == "code")

all.data <- all.data %>%
  filter(speaker != "") %>%
  left_join(ptcp.info, by = "aclew_child_id") %>%
  mutate(segment = "", sample = "",
         sample_type = "", clip_dur = 0)

for (i in 1:nrow(codes)) {
  rec <- codes$aclew_child_id[i]
  seg <- as.character(codes$val[i])
  seg.on <- codes$start[i]
  seg.off <- codes$stop[i]
  seg.idx <- which(all.data$aclew_child_id == rec &
                     all.data$start < seg.off &
                     all.data$stop > seg.on)
  all.data$segment[seg.idx] <- seg
  all.data$clip_dur[seg.idx] <- codes$dur[i]
}

# Remove utterances that occur outside of the annotated clips
all.data$sample[which(
  grepl('^random', all.data$segment))] <- "random"
all.data$sample[which(
  grepl('tt', all.data$segment))] <- "turn-taking"
all.data$sample[which(
  grepl('va', all.data$segment))] <- "vocal-activity"
all.data <- filter(all.data, sample != "")
# shorten utterance bouncaries that extend outside of the annotated clips
# NOTE: because of the split extensions with the same names
# we have to be cautious (e.g., if there are two 'ext-va-1' codes)
# for a given recording
seg.on.off <- seg.info %>%
  select(aclew_child_id, start, stop, val) %>%
  rename(clip_start = "start", clip_stop = "stop", segment = val) %>%
  mutate(clip_dur = clip_stop - clip_start)
for (i in 1:nrow(seg.on.off)) {
  over.left.edge.idx <- which(all.data$aclew_child_id == seg.on.off$aclew_child_id[i] &
                          all.data$start < seg.on.off$clip_stop[i] &
                          all.data$stop > seg.on.off$clip_start[i] &
                          all.data$start < seg.on.off$clip_start[i])
  over.right.edge.idx <- which(all.data$aclew_child_id == seg.on.off$aclew_child_id[i] &
                          all.data$start < seg.on.off$clip_stop[i] &
                          all.data$stop > seg.on.off$clip_start[i] &
                          all.data$stop > seg.on.off$clip_stop[i])
  if (length(over.left.edge.idx) > 0) {
    all.data$start[over.left.edge.idx] <- seg.on.off$clip_start[i]
  }
  
  if (length(over.right.edge.idx) > 0) {
    all.data$stop[over.right.edge.idx] <- seg.on.off$clip_stop[i]
  }
}

# Add basic segment info to all.data
all.data <- all.data %>%
  left_join(seg.on.off) %>%
  mutate(
    sample_type = case_when(
      grepl("^ran", segment) ~ "random",
      grepl("^ext", segment) ~ "extension",
      grepl("^tt", segment) ~ "turn-taking",
      grepl("^va", segment) ~ "vocal-activity"
    ),
    segment_dur = case_when(
      sample_type == "random" ~ rand.sample.dur,
      sample_type == "extension" ~ ext.sample.dur,
      sample_type == "turn-taking" |
        sample_type == "vocal-activity" ~ peak.sample.dur
    ))


# Add in segment start time
mini.clip.info <- select(seg.info, c("aclew_child_id", "val",
  "start.hhmmss", "start.sec", "start.hr", "start")) %>%
  rename("segment" = "val", "clip.start.hhmmss" = "start.hhmmss",
    "clip.start.sec" = "start.sec", "clip.start.hr" = "start.hr",
    "clip_start" = "start")
all.data <- all.data %>%
  left_join(mini.clip.info)
```

```{r demog_table_prep, message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
sample.demog <- ptcp.info %>%
  mutate(mat_age_rd = as.integer(round(mat_age, 0)),
         fat_age_rd = as.integer(round(fat_age, 0)),
         hszrd = as.integer(round(household_size + 1, 0))) %>%
  select(age_childes, child_sex, mat_age_rd, mat_ed, hszrd) %>%
  arrange(age_childes) %>%
  rename("Age" = age_childes, "Sex" = child_sex,
         "Mother's age" = mat_age_rd, "Level of maternal education" = mat_ed,
         "People in household" = hszrd)
```

```{r tab1, echo=FALSE, results='asis', message=FALSE, warning=FALSE}
apa_table(sample.demog, caption="Demographic overview of the 10 children whose recordings are sampled in the current study, including from left to right: child's age (years;months.days); child's sex (M/F); mother's age (years); highest level of maternal education achieved (none (grades 0--5)/primary (grades 6--7)/secondary (grades 8--11)/preparatory (grade 12)); and the number of people living in the child's household.")
```

```{r fig1, echo=FALSE, fig.cap="Recording duration (black line) and sampled clips (colored boxes) for each of the 10 recordings analyzed, sorted by child age in months.", message=FALSE, warning=FALSE, fig.height=4}
ptcp.info <- ptcp.info %>%
  arrange(age_mo_round) %>%
  mutate(order = seq(1:10))

used.clips <- seg.info %>%
  mutate(
    alt.seg.name = gsub("ext-", "", val)) %>%
  group_by(aclew_child_id, alt.seg.name) %>%
  summarize(start.hhmmss = min(start.hhmmss),
            start.hr = min(start.hr),
            start.rec.hr = min(start_of_wav.ms)/3600000,
            end.rec.hr = min(stop_of_wav.ms)/3600000,
            clip.dur = sum(dur)/60000) %>%
  rename(segment = alt.seg.name) %>%
  mutate(sample.type = case_when(
      grepl('random', segment) ~ "Random",
      grepl('tt', segment) ~ "Turn taking",
      grepl('va', segment) ~ "Vocal activity")) %>%
  left_join(ptcp.info)
used.clips$sample.type = factor(used.clips$sample.type,
                                levels = c(
                                  "Random", "Turn taking",
                                  "Vocal activity"))
  
clip.distribution <- ggplot(data = used.clips) +
  geom_segment(data = filter(used.clips, segment == "random-1"),
               aes(x = start.rec.hr, y = order,
                   xend = end.rec.hr, yend = order)) +
  geom_segment(aes(x = start.hr, y = order,
                   xend = start.hr + clip.dur/60, yend = order,
                   color = sample.type), size = 3) +
  theme_apa() +
  theme(legend.position = "bottom") +
  scale_x_continuous(breaks = 7:21) +
  scale_y_continuous(breaks = 1:10, labels = ptcp.info$age_mo_round) +
  ylab("Child age (mo)") + xlab("Time of day (hr)") + labs(color = "Sample type") +
  scale_color_manual(values = c(viridis(3)[1], viridis(3)[2], "blue"))
clip.distribution
```

## Data selection and annotation {#methods-samples}
From the daylong recordings of 57 Rossel children, we selected 10 representative children between ages 0;0 and 3;0 for transcription and analysis. The 10 children were selected to be spread between the target age range (0;0--3;0) while also representing a range of typical maternal education levels found in the community and being evenly split between male and female children ([Table 1](#tab1)). We selected a series of non-overlapping sub-clips from each recording for transcription ([Figure 1](#fig1)) in the following order: nine randomly-selected 2.5-minute clips, five manually-selected 'peak' turn-taking activity 1-minute clips, five manually-selected 'peak' **target child** vocal activity 1-minute clips, and one manually-selected 5-minute expansion of the best one-minute clip, for a total of 37.5 minutes of transcribed audio for each child (6.25 audio hours in total).

**Manual clip selection proceeded as follows: one person (the first author or a non-Rossel research assistant) listened through the entirety of each recording, documenting the approximate onset time, duration, and notable features of any short period that they perceived to be a _burst_ of turn taking and/or target-child vocalization; judgments were made subjectively, and with reference to the lack of such activity in other parts of the recording. After compiling a list candidate bursts for each recording, the first author listened again to each candidate, adding further notes about the diversity of target-child vocalizations and the density of turn taking. Clips that overlapped with previously transcribed segments or that featured significant background noise were eliminated. From the remainder, the five 1-minute clips that best demonstrated sequences of temporally contingent vocalization between the target child and at least one other person were selected as the 'turn-taking' clips. From the remaining candidate clips, the five that best demonstrated high density, high maturity, and high diversity vocalizations by the target child were selected as the 'vocal activity' clips. After these ten 1-minute clips had been transcribed for each recording (i.e., during the field visit), the first author assessed each for its density of vocal and turn-taking activity and searched for continuation of that activity before and after the one-minute clip. The clip that best balanced dense, minimally repetititious verbal activity with continuation in neighboring minutes was selected to have a 5-minute extension window for further annotation. All else being equal, we give preference to clips featuring speech from underrepresented foreground speakers (e.g., adult males; see more details at OMITTED-FOR-REVIEW<!--https://git.io/fhdUm-->).**

**We were limited to annotating these** sub-clips from only 10 children because of the time-intensive nature of transcribing these naturalistic data; 1 minute of audio typically took approximately 60--70 minutes to be segmented into utterances, transcribed, annotated, and loosely translated into English (~400 hours total). Yélî Dnye is almost exclusively spoken on Rossel Island, where there is no electricity (we use solar panels) and unreliable access to mobile data, so transcription was completed over the course of three 4–6 week visits to the island in 2016, 2018, and 2019.

We used the ACLEW Annotation Scheme [@casillas2017ACLEWDAS] in ELAN [@ELAN] to transcribe and annotate all hearable speech in the clips. Using both the audio and photo context, we segmented out the utterances and ascribed them to individual speakers (e.g., older brother, mother, aunt, etc.). We then annotated the vocal maturity of each utterance produced by the target child (non-canonical babble/canonical babble/single word/multi-word/unsure) and annotated the addressee of all speech from other speakers (addressed to the target child/one or more other children/one or more adults/a mix of adults and children/any animal/other/unsure). **Regarding vocal maturity annotations, an vocalization was considered 'single word' if it contained a single recognizable (transcribed) lexical type (e.g., 'mine', 'mine mine') and 'multi-word' if it contained more than one lexical type (e.g., 'my mango'), with non-lexical lingusitic vocalizations annotated as 'canonical babble' (containing at least one consonant with an adult-like transition with its neighboring vocalic sound(s)) or 'non-canonical babble', and non-linguistic vocalizations classified as 'crying' or 'laughing'. Vocalizations that were too ambiguous to make a decision were marked as 'unsure'. Vegetative sounds (e.g., sneezes) were ignored. Regarding addressee annotations, the audio and photo context were used to review who each speaker was talking to for each utterance; utterances were only considered directed to the target child when the native Rossel-speaking research assistant and first author felt certain of this judgment given the context. Utterances were otherwise classified as directed to a 'child' (1+ children; a group of children including the target child), 'adult' (1+ adults), 'both' (1+ children and 1+ adults; a group that may include the target child), 'animal' (1+ animals), 'other' (a clear addressee that doesn't fit into the other categories), or 'unsure' (not enough evidence to make a judgment). Note that all transcription** and annotation was done together by the first author and one of three community members (all native Yélî Dnye speakers). The community-based research assistants personally knew all the families in the recordings, and were able to use their own experience, the discourse context, and information from the accompanying photos in reporting what was said and to whom speech was addressed for each utterance. **These annotations relied on mutual agreement between the first author and the Rossel research assistant, so there is no direct way to estimate interrater reliability for the NN target-child vocalizations and NN other-speaker vocalizations discovered in the clips. That said, independent vocal maturity annotations of these same target child vocalizations in a different studied revealed a highly similar pattern of results (OMITTED-FOR-REVIEW).** Detailed manuals and self-guided training materials, including a 'gold standard test' for this annotation scheme can be found at OMITTED-FOR-REVIEW<!--https://osf.io/b2jep/wiki/home/ [@casillas2017ACLEWDAS]-->.

In what follows we first analyze the nine randomly selected 2.5-minute clips from each child to establish a baseline view of their speech environment, focusing on the effects of child age, time of day, household size, and number of speakers on the rate of target child-directed (TCDS) and other-directed speech (ODS). Next, we repeat these analyses, focusing instead only on the turn-taking clips to gain a view of the speech environment as it appears during the peak interactions for the day. Then as a first approximation of children's linguistic development, we map a coarse trajectory of children's use of babble, first words, and multi-word utterances. Finally, we wrap up by integrating our Panoramic-approach results with those from prior Close Study work, relating these findings to the larger literature on child-directed speech and its role in language development.

## Statistical models
We conducted all analyses in R, using the glmmTMB package to run generalized linear mixed-effects regressions [@brooks2017modeling; @R-base] and ggplot2 to generate figures [@R-ggplot2]. This dataset and analysis are available at URL_MASKED_FOR_REVIEW<!--https://github.com/marisacasillas/Yeli-CLE-->. TCDS and ODS minutes per hour are naturally restricted to non-negative (0--infinity) values, causing the distributional variance of those measures to become positively skewed. To address this issue we use negative binomial regressions, which can better fit non-negative, overdispersed data [@brooks2017modeling; @smithson2013generalized]. There were also many cases of zero minutes of TCDS across the clips---for example, this often occurred in the randomly sampled clips when the child was sleeping in a quiet area. To handle this additional distributional characteristic of the data, we added a zero-inflation model to TCDS analysis which, in addition to the count model of TCDS (e.g., testing effects of age on the input rate), creates a binary model to evaluate the likelihood of TCDS being used at all. More conventional, gaussian linear mixed-effects regressions with log-transformed dependent variables are provided in the Supplementary Materials, but are qualitatively similar to what we report here.

# Results {#results}
The models included the following predictors: child age (months; centered and standardized), household size (number of people; centered and standardized), number of non-target-child speakers present in that clip (centered and standardized), and time of day at the start of the clip (factor: "morning" = before 11:00; "midday" = 11:00--13:00; "afternoon" = after 13:00). We also included two-way interactions of (a) child age and the number of speakers present and (b) child age and time of day, with a random effect of child. For the zero-inflation model of TCDS, we included the number of speakers present. We limit our discussion to significant effects; full model results are provided in the Supplementary Materials.

```{r quantity_prep, message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
# RANDOM
# Get min/hr speech measures
n.unique.rand.segs <- length(unique(
  all.data$segment[grepl("random", all.data$segment)]))
n.unique.recs <- length(unique(all.data$aclew_child_id))
all.rand.segments <- tibble(
  aclew_child_id = rep(unique(all.data$aclew_child_id),
                n.unique.rand.segs),
  segment = rep(unique(all.data$segment[grepl(
    "random", all.data$segment)]),
                n.unique.recs))
# XDS
xds.per.seg.rand <- all.data %>%
  filter(sample == "random" & speaker != "CHI" &
           grepl("xds@", tier)) %>%
  group_by(aclew_child_id, segment, segment_dur) %>%
  summarise(xds_min = round(sum(dur)/60000,3)) %>%
  full_join(all.rand.segments, by = c("aclew_child_id", "segment")) %>%
  replace_na(list(segment_dur = rand.sample.dur, xds_min = 0)) %>%
  mutate(xds_mph = (xds_min/segment_dur)*60) %>%
  arrange(aclew_child_id, segment)
# ODS
ods.per.seg.rand <- all.data %>%
  filter(sample == "random" & speaker != "CHI" &
           grepl("xds@", tier) & val != "T") %>%
  group_by(aclew_child_id, segment, segment_dur) %>%
  summarise(ods_min = round(sum(dur)/60000,3)) %>%
  full_join(all.rand.segments, by = c("aclew_child_id", "segment")) %>%
  replace_na(list(segment_dur = rand.sample.dur, ods_min = 0)) %>%
  mutate(ods_mph = (ods_min/segment_dur)*60) %>%
  arrange(aclew_child_id, segment)
# TDS
tds.per.seg.rand <- all.data %>%
  filter(sample == "random" & speaker != "CHI" &
           grepl("xds@", tier) & val == "T") %>%
  group_by(aclew_child_id, segment, segment_dur) %>%
  summarise(tds_min = round(sum(dur)/60000,3)) %>%
  full_join(all.rand.segments, by = c("aclew_child_id", "segment")) %>%
  replace_na(list(segment_dur = rand.sample.dur, tds_min = 0)) %>%
  mutate(tds_mph = (tds_min/segment_dur)*60) %>%
  arrange(aclew_child_id, segment)
# All CDS
cds.per.seg.rand <- all.data %>%
  filter(sample == "random" & speaker != "CHI" &
           grepl("xds@", tier) & (val == "T" | val == "C")) %>%
  group_by(aclew_child_id, segment, segment_dur) %>%
  summarise(cds_min = round(sum(dur)/60000,3)) %>%
  full_join(all.rand.segments, by = c("aclew_child_id", "segment")) %>%
  replace_na(list(segment_dur = rand.sample.dur, cds_min = 0)) %>%
  mutate(cds_mph = (cds_min/segment_dur)*60) %>%
  arrange(aclew_child_id, segment)
# Number of speakers per clip
spkrs.per.seg.rand <- all.data %>%
  filter(sample == "random" & speaker != "CHI" &
           !(grepl("@", tier))) %>%
  group_by(aclew_child_id, segment) %>%
  summarise(n_spkrs_clip = length(unique(speaker)))
# All together
quantity.rand <- xds.per.seg.rand %>%
  full_join(ods.per.seg.rand,
    by = c("aclew_child_id", "segment", "segment_dur")) %>%
  full_join(tds.per.seg.rand,
    by = c("aclew_child_id", "segment", "segment_dur")) %>%
  full_join(cds.per.seg.rand,
    by = c("aclew_child_id", "segment", "segment_dur")) %>%
  left_join(spkrs.per.seg.rand,
    by = c("aclew_child_id", "segment")) %>%
  left_join(dplyr::select(seg.info, c("aclew_child_id", "val", "start.hr")),
            by = c("aclew_child_id" = "aclew_child_id", "segment" = "val")) %>%
  full_join(ptcp.info, by = "aclew_child_id") %>%
  replace_na(list(xds_min = 0, xds_mph = 0,
                  tds_min = 0, tds_mph = 0,
                  cds_min = 0, cds_mph = 0,
                  n_spkrs_clip = 0)) %>%
  mutate(prop_tds = tds_min/xds_min)
  # Don't replace NAs with 0s in this case;
  # proportion is not meaningful w/o any speech
quantity.rand.bychild <- quantity.rand %>%
  group_by(aclew_child_id) %>%
  summarise(
    xds_min = mean(xds_min),
    xds_mph = mean(xds_mph),
    ods_min = mean(ods_min),
    ods_mph = mean(ods_mph),
    tds_min = mean(tds_min),
    tds_mph = mean(tds_mph),
    cds_min = mean(cds_min),
    cds_mph = mean(cds_mph),
    prop_tds = mean(prop_tds, na.rm = TRUE),
    m_n_spkrs = mean(n_spkrs_clip)) %>%
  full_join(ptcp.info, by = "aclew_child_id")

# Get xds and tds min/hr by speaker type
all.data$SpkrAge <- "Not known"
all.data$SpkrAge[grepl("FA|MA|UA", all.data$speaker)] <- "Adult"
all.data$SpkrAge[grepl("FC|MC|UC", all.data$speaker)] <- "Child"
all.rand.segments.sa <- tibble(
  aclew_child_id = rep(unique(all.data$aclew_child_id),
                2*n.unique.rand.segs),
  segment = rep(unique(all.data$segment[grepl("random", all.data$segment)]),
                2*n.unique.recs),
  SpkrAge = c(rep("Adult", (n.unique.rand.segs * n.unique.recs)),
              rep("Child", (n.unique.rand.segs * n.unique.recs))))

# Add in speaker sex
all.data$SpkrSex <- "Not known"
all.data$SpkrSex[grepl("FA|FC|FU", all.data$speaker)] <- "Female"
all.data$SpkrSex[grepl("MA|MC|MU", all.data$speaker)] <- "Male"
all.rand.segments.age.sx <- tibble(
  aclew_child_id = rep(unique(all.data$aclew_child_id),
                4*n.unique.rand.segs),
  segment = rep(unique(all.data$segment[grepl("random", all.data$segment)]),
                4*n.unique.recs),
  SpkrAge = c(rep("Adult", (n.unique.rand.segs * n.unique.recs)),
              rep("Child", (n.unique.rand.segs * n.unique.recs)),
              rep("Adult", (n.unique.rand.segs * n.unique.recs)),
              rep("Child", (n.unique.rand.segs * n.unique.recs))),
  SpkrSex = c(rep("Female", (n.unique.rand.segs * (2 * n.unique.recs))),
              rep("Male", (n.unique.rand.segs * (2 * n.unique.recs)))))

# XDS
xds.per.seg.rand.sa <- all.data %>%
  filter(sample == "random" & speaker != "CHI" &
      SpkrAge != "Not known" & grepl("xds@", tier)) %>%
  group_by(aclew_child_id, SpkrAge, segment, segment_dur) %>%
  summarise(xds_min.sa = round(sum(dur)/60000,3)) %>%
  full_join(all.rand.segments.sa,
    by = c("aclew_child_id", "segment", "SpkrAge")) %>%
  replace_na(list(segment_dur = rand.sample.dur, xds_min.sa = 0)) %>%
  mutate(xds_mph.sa = (xds_min.sa/segment_dur)*60) %>%
  arrange(aclew_child_id, segment, SpkrAge)
# ODS
ods.per.seg.rand.sa <- all.data %>%
  filter(sample == "random" & speaker != "CHI" &
      SpkrAge != "Not known" & grepl("xds@", tier) & val != "T") %>%
  group_by(aclew_child_id, SpkrAge, segment, segment_dur) %>%
  summarise(ods_min.sa = round(sum(dur)/60000,3)) %>%
  full_join(all.rand.segments.sa,
    by = c("aclew_child_id", "segment", "SpkrAge")) %>%
  replace_na(list(segment_dur = rand.sample.dur, ods_min.sa = 0)) %>%
  mutate(ods_mph.sa = (ods_min.sa/segment_dur)*60) %>%
  arrange(aclew_child_id, segment, SpkrAge)
# TDS
tds.per.seg.rand.sa <- all.data %>%
  filter(sample == "random" & speaker != "CHI" &
      SpkrAge != "Not known" & grepl("xds@", tier) & val == "T") %>%
  group_by(aclew_child_id, SpkrAge, segment, segment_dur) %>%
  summarise(tds_min.sa = round(sum(dur)/60000,3)) %>%
  full_join(all.rand.segments.sa,
    by = c("aclew_child_id", "segment", "SpkrAge")) %>%
  replace_na(list(segment_dur = rand.sample.dur, tds_min.sa = 0)) %>%
  mutate(tds_mph.sa = (tds_min.sa/segment_dur)*60) %>%
  arrange(aclew_child_id, segment, SpkrAge)
# All CDS
cds.per.seg.rand.sa <- all.data %>%
  filter(sample == "random" & speaker != "CHI"
    & SpkrAge != "Not known" & grepl("xds@", tier) &
      (val == "T" | val == "C")) %>%
  group_by(aclew_child_id, SpkrAge, segment, segment_dur) %>%
  summarise(cds_min.sa = round(sum(dur)/60000,3)) %>%
  full_join(all.rand.segments.sa,
    by = c("aclew_child_id", "segment", "SpkrAge")) %>%
  replace_na(list(segment_dur = rand.sample.dur, cds_min.sa = 0)) %>%
  mutate(cds_mph.sa = (cds_min.sa/segment_dur)*60) %>%
  arrange(aclew_child_id, segment, SpkrAge)
# Number of speakers per clip
spkrs.per.seg.rand.sa <- all.data %>%
  filter(sample == "random" & speaker != "CHI" &
      SpkrAge != "Not known" & !(grepl("@", tier))) %>%
  group_by(aclew_child_id, SpkrAge, segment) %>%
  summarise(n_spkrs_clip = length(unique(speaker)))
# All together
quantity.rand.sa <- xds.per.seg.rand.sa %>%
  full_join(ods.per.seg.rand.sa, by = c("aclew_child_id", "SpkrAge",
                                        "segment", "segment_dur")) %>%
  full_join(tds.per.seg.rand.sa, by = c("aclew_child_id", "SpkrAge",
                                        "segment", "segment_dur")) %>%
  full_join(cds.per.seg.rand.sa, by = c("aclew_child_id", "SpkrAge",
                                        "segment", "segment_dur")) %>%
  full_join(dplyr::select(quantity.rand,
    c("aclew_child_id", "segment", "tds_min")),
    by = c("aclew_child_id", "segment")) %>%
  full_join(spkrs.per.seg.rand.sa,
    by = c("aclew_child_id", "SpkrAge", "segment")) %>%
  left_join(dplyr::select(seg.info, c("aclew_child_id", "val", "start.hr")),
            by = c("aclew_child_id" = "aclew_child_id", "segment" = "val")) %>%
  full_join(ptcp.info, by = "aclew_child_id") %>%
  replace_na(list(xds_min.sa = 0, xds_mph.sa = 0,
                  ods_min.sa = 0, ods_mph.sa = 0,
                  tds_min.sa = 0, tds_mph.sa = 0,
                  cds_min.sa = 0, cds_mph.sa = 0,
                  n_spkrs_clip = 0)) %>%
  mutate(prop_tds.sa = tds_min.sa/xds_min.sa,
         prop_sa.tds = tds_min.sa/tds_min)
  # Don't replace NAs with 0s in this case;
  # proportion is not meaningful w/o any speech

perc_CHI_nspkrs_per_clip <- quantity.rand.sa %>%
  spread(SpkrAge, n_spkrs_clip) %>%
  group_by(aclew_child_id, segment) %>%
  summarize(
    n_ADU = max(Adult, na.rm = TRUE),
    n_CHI = max(Child, na.rm = TRUE)) %>%
  mutate(
    perc_ADU = n_ADU / (n_ADU + n_CHI))

# NON-RANDOM
# Get min/hr speech measures
all.nonrand.segments <- seg.info %>%
  filter(!(grepl("random", val))) %>%
  select(aclew_child_id, val, dur) %>%
  mutate(dur = dur/60000) %>%
  group_by(aclew_child_id, val) %>%
  summarize(segment_dur = sum(dur)) %>%
  rename(segment = "val") %>%
  mutate(
    sample = case_when(
      grepl("va", segment) ~ "vocal-activity",
      grepl("tt", segment) ~ "turn-taking"
    ),
    sample_type = case_when(
      grepl("^ext", segment) ~ "extension",
      grepl("^va", segment) ~ "vocal-activity",
      grepl("^tt", segment) ~ "turn-taking"
    )
  )

# XDS
xds.per.seg.nonrand <- all.data %>%
  filter(sample != "random" & speaker != "CHI" &
           grepl("xds@", tier)) %>%
  group_by(aclew_child_id, segment) %>%
  summarise(xds_min = round(sum(dur)/60000,3)) %>%
  full_join(all.nonrand.segments,
    by = c("aclew_child_id", "segment")) %>%
  replace_na(list(xds_min = 0)) %>%
  mutate(xds_mph = (xds_min/segment_dur)*60) %>%
  arrange(aclew_child_id, segment)
# ODS
ods.per.seg.nonrand <- all.data %>%
  filter(sample != "random" & speaker != "CHI" &
           grepl("xds@", tier) & val != "T") %>%
  group_by(aclew_child_id, segment) %>%
  summarise(ods_min = round(sum(dur)/60000,3)) %>%
  full_join(all.nonrand.segments,
    by = c("aclew_child_id", "segment")) %>%
  replace_na(list(ods_min = 0)) %>%
  mutate(ods_mph = (ods_min/segment_dur)*60) %>%
  arrange(aclew_child_id, segment)
# TDS
tds.per.seg.nonrand <- all.data %>%
  filter(sample != "random" & speaker != "CHI" &
           grepl("xds@", tier) & val == "T") %>%
  group_by(aclew_child_id, segment) %>%
  summarise(tds_min = round(sum(dur)/60000,3)) %>%
  full_join(all.nonrand.segments,
    by = c("aclew_child_id", "segment")) %>%
  replace_na(list(tds_min = 0)) %>%
  mutate(tds_mph = (tds_min/segment_dur)*60) %>%
  arrange(aclew_child_id, segment)
# All CDS
cds.per.seg.nonrand <- all.data %>%
  filter(sample != "random" & speaker != "CHI" &
           grepl("xds@", tier) & (val == "T" | val == "C")) %>%
  group_by(aclew_child_id, segment) %>%
  summarise(cds_min = round(sum(dur)/60000,3)) %>%
  full_join(all.nonrand.segments,
    by = c("aclew_child_id", "segment")) %>%
  replace_na(list(cds_min = 0)) %>%
  mutate(cds_mph = (cds_min/segment_dur)*60) %>%
  arrange(aclew_child_id, segment)
# Number of speakers per clip
spkrs.per.seg.nonrand <- all.data %>%
  filter(sample != "random" & speaker != "CHI"
    & !(grepl("@", tier))) %>%
  group_by(aclew_child_id, segment) %>%
  summarise(n_spkrs_clip = length(unique(speaker)))
# All together
seg.distinct <- seg.info %>%
  group_by(aclew_child_id, val) %>%
  summarize(start.hr.min = min(start.hr)) %>%
  rename(start.hr = start.hr.min)
quantity.nonrand <- xds.per.seg.nonrand %>%
  full_join(ods.per.seg.nonrand,
    by = c("aclew_child_id", "segment",
      "segment_dur", "sample", "sample_type")) %>%
  full_join(tds.per.seg.nonrand,
    by = c("aclew_child_id", "segment",
      "segment_dur", "sample", "sample_type")) %>%
  full_join(cds.per.seg.nonrand,
    by = c("aclew_child_id", "segment",
      "segment_dur", "sample", "sample_type")) %>%
  full_join(ptcp.info, by = "aclew_child_id") %>%
  full_join(spkrs.per.seg.nonrand,
    by = c("aclew_child_id", "segment")) %>%
  left_join(seg.distinct,
            by = c("aclew_child_id" = "aclew_child_id",
              "segment" = "val")) %>%
  replace_na(list(xds_min = 0, xds_mph = 0,
                  ods_min = 0, ods_mph = 0,
                  tds_min = 0, tds_mph = 0,
                  cds_min = 0, cds_mph = 0,
                  n_spkrs_clip = 0)) %>%
  mutate(prop_tds = tds_min/xds_min)
  # Don't replace NAs with 0s in this case;
  # proportion is not meaningful w/o any speech
quantity.nonrand.bychild <- quantity.nonrand %>%
  group_by(aclew_child_id, sample) %>%
  summarise(
    xds_min = mean(xds_min),
    xds_mph = mean(xds_mph),
    ods_min = mean(ods_min),
    ods_mph = mean(ods_mph),
    tds_min = mean(tds_min),
    tds_mph = mean(tds_mph),
    cds_min = mean(cds_min),
    cds_mph = mean(cds_mph),
    prop_tds = mean(prop_tds, na.rm = TRUE),
    m_n_spkrs = mean(n_spkrs_clip)) %>%
  full_join(ptcp.info, by = "aclew_child_id")

# Get xds and tds min/hr by speaker type
all.nonrand.segments.sa <- tibble(
  aclew_child_id = rep(all.nonrand.segments$aclew_child_id, 2),
  segment = rep(all.nonrand.segments$segment, 2),
  segment_dur = rep(all.nonrand.segments$segment_dur, 2),
  sample = rep(all.nonrand.segments$sample, 2),
  sample_type = rep(all.nonrand.segments$sample_type, 2),
  SpkrAge = c(rep("Adult", nrow(all.nonrand.segments)),
              rep("Child", nrow(all.nonrand.segments))))
# XDS
xds.per.seg.nonrand.sa <- all.data %>%
  filter(sample != "random" & speaker != "CHI" &
      SpkrAge != "Not known" & grepl("xds@", tier)) %>%
  group_by(aclew_child_id, SpkrAge, segment) %>%
  summarise(xds_min.sa = round(sum(dur)/60000,3)) %>%
  full_join(all.nonrand.segments.sa,
    by = c("aclew_child_id", "segment", "SpkrAge")) %>%
  replace_na(list(xds_min.sa = 0)) %>%
  mutate(xds_mph.sa = (xds_min.sa/segment_dur)*60) %>%
  arrange(aclew_child_id, segment, SpkrAge)
# ODS
ods.per.seg.nonrand.sa <- all.data %>%
  filter(sample != "random" & speaker != "CHI" &
      SpkrAge != "Not known" & grepl("xds@", tier) & val != "T") %>%
  group_by(aclew_child_id, SpkrAge, segment) %>%
  summarise(ods_min.sa = round(sum(dur)/60000,3)) %>%
  full_join(all.nonrand.segments.sa,
    by = c("aclew_child_id", "segment", "SpkrAge")) %>%
  replace_na(list(ods_min.sa = 0)) %>%
  mutate(ods_mph.sa = (ods_min.sa/segment_dur)*60) %>%
  arrange(aclew_child_id, segment, SpkrAge)
# TDS
tds.per.seg.nonrand.sa <- all.data %>%
  filter(sample != "random" & speaker != "CHI" &
      SpkrAge != "Not known" & grepl("xds@", tier) & val == "T") %>%
  group_by(aclew_child_id, SpkrAge, segment) %>%
  summarise(tds_min.sa = round(sum(dur)/60000,3)) %>%
  full_join(all.nonrand.segments.sa,
    by = c("aclew_child_id", "segment", "SpkrAge")) %>%
  replace_na(list(tds_min.sa = 0)) %>%
  mutate(tds_mph.sa = (tds_min.sa/segment_dur)*60) %>%
  arrange(aclew_child_id, segment, SpkrAge)
# All CDS
cds.per.seg.nonrand.sa <- all.data %>%
  filter(sample != "random" & speaker != "CHI" &
      SpkrAge != "Not known" & grepl("xds@", tier) &
      (val == "T" | val == "C")) %>%
  group_by(aclew_child_id, SpkrAge, segment) %>%
  summarise(cds_min.sa = round(sum(dur)/60000,3)) %>%
  full_join(all.nonrand.segments.sa,
    by = c("aclew_child_id", "segment", "SpkrAge")) %>%
  replace_na(list(cds_min.sa = 0)) %>%
  mutate(cds_mph.sa = (cds_min.sa/segment_dur)*60) %>%
  arrange(aclew_child_id, segment, SpkrAge)
# Number of speakers per clip
spkrs.per.seg.nonrand.sa <- all.data %>%
  filter(sample != "random" & speaker != "CHI" &
      SpkrAge != "Not known" & !(grepl("@", tier))) %>%
  group_by(aclew_child_id, SpkrAge, segment) %>%
  summarise(n_spkrs_clip = length(unique(speaker)))
# All together
quantity.nonrand.sa <- xds.per.seg.nonrand.sa %>%
  full_join(ods.per.seg.nonrand.sa, by = c("aclew_child_id", "SpkrAge",
                                           "segment", "segment_dur",
                                           "sample", "sample_type")) %>%
  full_join(tds.per.seg.nonrand.sa, by = c("aclew_child_id", "SpkrAge",
                                           "segment", "segment_dur",
                                           "sample", "sample_type")) %>%
  full_join(cds.per.seg.nonrand.sa, by = c("aclew_child_id", "SpkrAge",
                                           "segment", "segment_dur",
                                           "sample", "sample_type")) %>%
  full_join(dplyr::select(quantity.nonrand,
    c("aclew_child_id", "segment", "tds_min")),
    by = c("aclew_child_id", "segment")) %>%
  full_join(ptcp.info, by = "aclew_child_id") %>%
  full_join(spkrs.per.seg.nonrand.sa,
    by = c("aclew_child_id", "SpkrAge", "segment")) %>%
  left_join(seg.distinct,
            by = c("aclew_child_id" = "aclew_child_id", "segment" = "val")) %>%
  replace_na(list(xds_min.sa = 0, xds_mph.sa = 0,
                  ods_min.sa = 0, ods_mph.sa = 0,
                  tds_min.sa = 0, tds_mph.sa = 0,
                  cds_min.sa = 0, cds_mph.sa = 0,
                  n_spkrs_clip = 0)) %>%
  mutate(prop_tds.sa = tds_min.sa/xds_min.sa,
         prop_sa.tds = tds_min.sa/tds_min)
  # Don't replace NAs with 0s in this case;
  # proportion is not meaningful w/o any speech

# Subset the non-random samples (used for differnt purposes)
quantity.nonrand.tt <- filter(quantity.nonrand, sample == "turn-taking")
quantity.nonrand.tt.sa <- filter(quantity.nonrand.sa, sample == "turn-taking")
quantity.nonrand.va <- filter(quantity.nonrand, sample == "vocal-activity")
quantity.nonrand.va.sa <- filter(quantity.nonrand.sa, sample == "vocal-activity")


## Get variables ready for modeling
# random sample
quantity.rand$child_sex <- as.factor(quantity.rand$child_sex)
quantity.rand$mat_ed <- as.factor(quantity.rand$mat_ed)
nspkrs.m <- mean(quantity.rand$n_spkrs_clip)
nspkrs.sd <- sd(quantity.rand$n_spkrs_clip)
quantity.rand <- quantity.rand %>%
  mutate(
    xds_mph.nz = ifelse(xds_mph > 0, 1, 0),
    ods_mph.nz = ifelse(ods_mph > 0, 1, 0),
    tds_mph.nz = ifelse(tds_mph > 0, 1, 0),
    cds_mph.nz = ifelse(cds_mph > 0, 1, 0),
    tchiyr.std = ((age_mo_round - tchiyr.m)/tchiyr.sd),
    chisx.std = recode_factor(child_sex,
                              "M" = "M", "F" = "F"),
    mated.std = recode_factor(mat_ed,
      "none" = "none", "primary" = "primary",
      "secondary" = "secondary", "preparatory" = "preparatory"),
    mated.bin = recode_factor(mat_ed,
      "none" = "0-6", "primary" = "0-6",
      "secondary" = "7+", "preparatory" = "7+"),
    motyr.std = ((mat_age - motyr.m)/motyr.sd),
    nsb.std = ((number_older_sibs - nsb.m)/nsb.sd),
    hsz.std = ((household_size - hsz.m)/hsz.sd),
    nsk.std = ((n_spkrs_clip - nspkrs.m)/nspkrs.sd),
    stthr.std = (start.hr - 12)/12,
    stthr.tri = ifelse(start.hr < 11, "morning",
                       ifelse(start.hr > 13, "afternoon", "midday")))
quantity.rand$stthr.tri <- factor(quantity.rand$stthr.tri,
                                  levels = c("midday", "morning", "afternoon"))
quantity.rand$stthr.tri.a <- factor(quantity.rand$stthr.tri,
                                  levels = c("afternoon", "midday", "morning"))
quantity.rand$stthr.tri.o <- factor(quantity.rand$stthr.tri,
                                  levels = c("morning", "afternoon", "midday"))

quantity.rand.sa$child_sex <- as.factor(quantity.rand.sa$child_sex)
quantity.rand.sa$mat_ed <- as.factor(quantity.rand.sa$mat_ed)
nspkrs.sa.m <- mean(quantity.rand.sa$n_spkrs_clip)
nspkrs.sa.sd <- sd(quantity.rand.sa$n_spkrs_clip)
quantity.rand.sa <- quantity.rand.sa %>%
  mutate(
    xds_mph.sa.nz = ifelse(xds_mph.sa > 0, 1, 0),
    ods_mph.sa.nz = ifelse(ods_mph.sa > 0, 1, 0),
    tds_mph.sa.nz = ifelse(tds_mph.sa > 0, 1, 0),
    cds_mph.sa.nz = ifelse(cds_mph.sa > 0, 1, 0),
    tchiyr.std = ((age_mo_round - tchiyr.m)/tchiyr.sd),
    chisx.std = recode_factor(child_sex,
                              "M" = "M", "F" = "F"),
    mated.std = recode_factor(mat_ed,
      "none" = "none", "primary" = "primary",
      "secondary" = "secondary", "preparatory" = "preparatory"),
    mated.bin = recode_factor(mat_ed,
      "none" = "0-6", "primary" = "0-6",
      "secondary" = "7+", "preparatory" = "7+"),
    motyr.std = ((mat_age - motyr.m)/motyr.sd),
    nsb.std = ((number_older_sibs - nsb.m)/nsb.sd),
    hsz.std = ((household_size - hsz.m)/hsz.sd),
    nsk.std = ((n_spkrs_clip - nspkrs.sa.m)/nspkrs.sa.sd),
    stthr.std = (start.hr - 12)/12,
    stthr.tri = ifelse(start.hr < 11, "morning",
                       ifelse(start.hr > 13, "afternoon", "midday")))
quantity.rand.sa$stthr.tri <- factor(quantity.rand.sa$stthr.tri,
                                     levels = c("midday", "morning", "afternoon"))
quantity.rand.sa$stthr.tri.a <- factor(quantity.rand.sa$stthr.tri,
                                       levels = c(
                                         "afternoon", "midday", "morning"))
quantity.rand.sa$stthr.tri.o <- factor(quantity.rand.sa$stthr.tri,
                                       levels = c(
                                         "morning", "afternoon", "midday"))


# tt sample
quantity.nonrand.tt$child_sex <- as.factor(quantity.nonrand.tt$child_sex)
quantity.nonrand.tt$mat_ed <- as.factor(quantity.nonrand.tt$mat_ed)
nspkrs.m <- mean(quantity.nonrand.tt$n_spkrs_clip)
nspkrs.sd <- sd(quantity.nonrand.tt$n_spkrs_clip)
quantity.nonrand.tt <- quantity.nonrand.tt %>%
  mutate(
    xds_mph.nz = ifelse(xds_mph > 0, 1, 0),
    ods_mph.nz = ifelse(ods_mph > 0, 1, 0),
    tds_mph.nz = ifelse(tds_mph > 0, 1, 0),
    cds_mph.nz = ifelse(cds_mph > 0, 1, 0),
    tchiyr.std = ((age_mo_round - tchiyr.m)/tchiyr.sd),
    chisx.std = recode_factor(child_sex,
                              "M" = "M", "F" = "F"),
    mated.std = recode_factor(mat_ed,
      "none" = "none", "primary" = "primary",
      "secondary" = "secondary", "preparatory" = "preparatory"),
    mated.bin = recode_factor(mat_ed,
      "none" = "0-6", "primary" = "0-6",
      "secondary" = "7+", "preparatory" = "7+"),
    motyr.std = ((mat_age - motyr.m)/motyr.sd),
    nsb.std = ((number_older_sibs - nsb.m)/nsb.sd),
    hsz.std = ((household_size - hsz.m)/hsz.sd),
    nsk.std = ((n_spkrs_clip - nspkrs.m)/nspkrs.sd),
    stthr.std = (start.hr - 12)/12,
    stthr.tri = ifelse(start.hr < 11, "morning",
                       ifelse(start.hr > 13, "afternoon", "midday")))
quantity.nonrand.tt$stthr.tri <- factor(quantity.nonrand.tt$stthr.tri,
                                        levels = c(
                                          "midday", "morning", "afternoon"))
quantity.nonrand.tt$stthr.tri.a <- factor(quantity.nonrand.tt$stthr.tri,
                                          levels = c(
                                            "afternoon", "midday", "morning"))
quantity.nonrand.tt$stthr.tri.o <- factor(quantity.nonrand.tt$stthr.tri,
                                          levels = c(
                                            "morning", "afternoon", "midday"))

quantity.nonrand.tt.sa$child_sex <- as.factor(quantity.nonrand.tt.sa$child_sex)
quantity.nonrand.tt.sa$mat_ed <- as.factor(quantity.nonrand.tt.sa$mat_ed)
nspkrs.sa.m <- mean(quantity.nonrand.tt.sa$n_spkrs_clip)
nspkrs.sa.sd <- sd(quantity.nonrand.tt.sa$n_spkrs_clip)
quantity.nonrand.tt.sa <- quantity.nonrand.tt.sa %>%
  mutate(
    xds_mph.sa.nz = ifelse(xds_mph.sa > 0, 1, 0),
    ods_mph.sa.nz = ifelse(ods_mph.sa > 0, 1, 0),
    tds_mph.sa.nz = ifelse(tds_mph.sa > 0, 1, 0),
    cds_mph.sa.nz = ifelse(cds_mph.sa > 0, 1, 0),
    tchiyr.std = ((age_mo_round - tchiyr.m)/tchiyr.sd),
    chisx.std = recode_factor(child_sex,
                              "M" = "M", "F" = "F"),
    mated.std = recode_factor(mat_ed,
      "none" = "none", "primary" = "primary",
      "secondary" = "secondary", "preparatory" = "preparatory"),
    mated.bin = recode_factor(mat_ed,
                              "none" = "0-6", "primary" = "0-6",
                              "secondary" = "7+", "preparatory" = "7+"),
    motyr.std = ((mat_age - motyr.m)/motyr.sd),
    nsb.std = ((number_older_sibs - nsb.m)/nsb.sd),
    hsz.std = ((household_size - hsz.m)/hsz.sd),
    nsk.std = ((n_spkrs_clip - nspkrs.sa.m)/nspkrs.sa.sd),
    stthr.std = (start.hr - 12)/12,
    stthr.tri = ifelse(start.hr < 11, "morning",
                       ifelse(start.hr > 13, "afternoon", "midday")))
quantity.nonrand.tt.sa$stthr.tri <- factor(quantity.nonrand.tt.sa$stthr.tri,
                                           levels = c(
                                             "midday", "morning", "afternoon"))
quantity.nonrand.tt.sa$stthr.tri.a <- factor(quantity.nonrand.tt.sa$stthr.tri,
                                             levels = c(
                                               "afternoon", "midday", "morning"))
quantity.nonrand.tt.sa$stthr.tri.o <- factor(quantity.nonrand.tt.sa$stthr.tri,
                                             levels = c(
                                               "morning", "afternoon", "midday"))

```

```{r quantity_plots, message=FALSE, warning=FALSE, paged.print=FALSE}
quantity.nonrand.tt.minimum <- dplyr::select(quantity.nonrand.tt,
                                             age_mo_round, xds_mph, ods_mph, tds_mph,
                                             prop_tds, n_spkrs_clip) %>%
                                             mutate(Sample = "Turn taking")
quantity.rand.minimum <- dplyr::select(quantity.rand,
                                       age_mo_round, xds_mph, ods_mph, tds_mph,
                                       prop_tds, n_spkrs_clip) %>%
                                       mutate(Sample = "Random")
quantity.rand_and_tt <- bind_rows(quantity.nonrand.tt.minimum, quantity.rand.minimum)

quantity.nonrand.sa.tt.minimum <- dplyr::select(quantity.nonrand.tt.sa,
                                             age_mo_round, prop_sa.tds, SpkrAge) %>%
                                             mutate(Sample = "Turn taking")
quantity.rand.sa.minimum <- dplyr::select(quantity.rand.sa,
                                       age_mo_round, prop_sa.tds, SpkrAge) %>%
                                       mutate(Sample = "Random")
quantity.sa.rand_and_tt <- bind_rows(
  quantity.nonrand.sa.tt.minimum, quantity.rand.sa.minimum)

write_csv(quantity.rand_and_tt,
          paste0(shiny.input.path,
                 "quantity-scores_rand-and-tt.csv"))

# ODS min/hr
odsmph.segments.rand_and_tt <- ggplot(quantity.rand_and_tt,
                          aes(x = age_mo_round, y = ods_mph, lty = Sample)) +
  geom_boxplot(aes(group = interaction(age_mo_round, Sample),
                   color = Sample), fill = "white", outlier.shape = NA,
               lty = "solid", alpha = 0.4) +
  geom_smooth(aes(fill = Sample, color = Sample), method = "lm") +
  ylab("ODS (min/hr)") + xlab("Child age (mo)")	+
  scale_y_continuous(limits=c(-10,80),
                     breaks=seq(0,80,20)) +
  scale_x_continuous(limits=c(0,38),
                     breaks=seq(0,38,6)) +
  coord_cartesian(ylim=c(0,80),xlim=c(0,38)) +
  scale_color_manual(values = viridis(3)) +
  scale_fill_manual(values = viridis(3)) +
  theme_apa() +
  theme(legend.position="none",
        axis.line = element_line(color="black", size = 0.4))

# TDS min/hr
tdsmph.segments.rand_and_tt <- ggplot(quantity.rand_and_tt,
                          aes(x = age_mo_round, y = tds_mph, lty = Sample)) +
  geom_boxplot(aes(group = interaction(age_mo_round, Sample),
                   color = Sample), fill = "white", outlier.shape = NA,
               lty = "solid", alpha = 0.4) +
  geom_smooth(aes(fill = Sample, color = Sample), method = "lm") +
  ylab("TCDS (min/hr)") + xlab("Child age (mo)")	+
  scale_y_continuous(limits=c(0,80),
                     breaks=seq(0,80,20)) +
  scale_x_continuous(limits=c(0,38),
                     breaks=seq(0,38,6)) +
  coord_cartesian(ylim=c(0,80),xlim=c(0,38)) +
  scale_color_manual(values = viridis(3)) +
  scale_fill_manual(values = viridis(3)) +
  theme_apa() +
  theme(legend.position="none",
        axis.line = element_line(color="black", size = 0.4))

# TDS min/hr - zoomed in
tdsmph.segments.rand_and_tt.zoomedin <- ggplot(quantity.rand_and_tt,
                          aes(x = age_mo_round, y = tds_mph, lty = Sample)) +
  geom_boxplot(aes(group = interaction(age_mo_round, Sample),
                   color = Sample), fill = "white", outlier.shape = NA,
               lty = "solid", alpha = 0.4) +
  geom_smooth(aes(fill = Sample, color = Sample), method = "lm") +
  ylab("TCDS (min/hr)") + xlab("Child age (mo)")	+
  scale_y_continuous(limits=c(0,40),
                     breaks=seq(0,40,10)) +
  scale_x_continuous(limits=c(0,38),
                     breaks=seq(0,38,6)) +
  coord_cartesian(ylim=c(0,40),xlim=c(0,38)) +
  scale_color_manual(values = viridis(3)) +
  scale_fill_manual(values = viridis(3)) +
  theme_apa() +
  theme(legend.position="none",
        axis.line = element_line(color="black", size = 0.4))

# TDS prop
tdsprp.segments.rand_and_tt <- ggplot(quantity.rand_and_tt,
                          aes(x = age_mo_round, y = prop_tds, lty = Sample)) +
  geom_boxplot(aes(group = interaction(age_mo_round, Sample),
                   color = Sample), fill = "white", outlier.shape = NA,
               lty = "solid", alpha = 0.4) +
  geom_smooth(aes(fill = Sample, color = Sample), method = "lm") +
  ylab("TCDS/All spch") + xlab("Child age (mo)")	+
  scale_y_continuous(limits=c(-.2,1.2),
                     breaks=seq(0,1,0.2)) +
  scale_x_continuous(limits=c(0,38),
                     breaks=seq(0,38,6)) +
  coord_cartesian(ylim=c(0,1),xlim=c(0,38)) +
  scale_color_manual(values = viridis(3)) +
  scale_fill_manual(values = viridis(3)) +
  theme_apa() +
  theme(legend.position="none",
        axis.line = element_line(color="black", size = 0.4))

# prop TDS from children
tdsprp.segments.rand_and_tt.sa <- ggplot(subset(quantity.sa.rand_and_tt,
                                                SpkrAge == "Child"),
                             aes(x = age_mo_round, y = prop_sa.tds, lty = Sample)) +
  geom_boxplot(aes(group = interaction(age_mo_round, Sample),
                   color = Sample), fill = "white", outlier.shape = NA,
               lty = "solid", alpha = 0.4) +
  geom_smooth(aes(fill = Sample, color = Sample), method = "lm") +
  ylab("Prop of TCDS") + xlab("Child age (mo)")	+
  scale_y_continuous(limits=c(-.2,1.2),
                     breaks=seq(0,1,0.2)) +
  scale_x_continuous(limits=c(0,38),
                     breaks=seq(0,38,6)) +
  coord_cartesian(ylim=c(0,1), xlim=c(0,38)) +
  scale_color_manual(values = viridis(3)) +
  scale_fill_manual(values = viridis(3)) +
  theme_apa() +
  theme(legend.position="none",
        axis.line = element_line(color="black", size = 0.4))

## TOD plots
quantity.nonrand.tt$Sample <- "Turn taking"
quantity.rand$Sample <- "Random"
quantity.rand_and_tt.all <- bind_rows(quantity.nonrand.tt, quantity.rand)
quantity.rand_and_tt.all$stthr.tri.centered <- factor(
  quantity.rand_and_tt.all$stthr.tri,
  levels = c("morning", "midday", "afternoon"))
quantity.rand_and_tt.all$SplitAge <- ifelse(
  quantity.rand_and_tt.all$age_mo_round < 13, "Under 1;0", "1;0+")
quantity.rand_and_tt.all$SplitAge <- factor(quantity.rand_and_tt.all$SplitAge,
  levels = c("Under 1;0", "1;0+"))

write_csv(quantity.rand_and_tt.all,
          paste0(shiny.input.path,
                 "quantity-scores_rand-and-tt-TOD.csv"))

tod.tcds <- ggplot(data = quantity.rand_and_tt.all, aes(
  y = round(tds_mph, 0), x = stthr.tri.centered,
  group = interaction(SplitAge, stthr.tri.centered),
  color = Sample,
  fill = Sample,
  alpha = SplitAge)) +
  geom_jitter() +
  geom_boxplot(color = "black") +
  facet_grid(~ Sample) +
  ylab("TCDS (min/hr)") + xlab("Time of day")	+
  labs(alpha = "Age") +
  scale_y_continuous(limits=c(-10,40),
                     breaks=c(0,10,20, 30, 40)) +
  scale_color_manual(guide = FALSE, values = viridis(3)) +
  scale_fill_manual(guide = FALSE, values = viridis(3)) +
  scale_alpha_discrete(range = c(0.2, 0.8)) +
  coord_cartesian(ylim=c(0,40)) +
  theme_apa() +
  theme(legend.position="right",
        axis.line = element_line(color="black", size = 0.4)) +
  guides(alpha = guide_legend(override.aes = list(
    fill = c("gray80", "gray30"))))

tod.ods <- ggplot(data = quantity.rand_and_tt.all, aes(
  y = round(ods_mph, 0), x = stthr.tri.centered,
  group = interaction(SplitAge, stthr.tri.centered),
  color = Sample,
  fill = Sample,
  alpha = SplitAge)) +
  geom_jitter() +
  geom_boxplot(color = "black") +
  facet_grid(~ Sample) +
  ylab("ODS (min/hr)") + xlab("Time of day")	+
  labs(alpha = "Age") +
  scale_y_continuous(limits=c(-10,80),
                     breaks=seq(0,80,20)) +
  scale_color_manual(guide = FALSE, values = viridis(3)) +
  scale_fill_manual(guide = FALSE, values = viridis(3)) +
  scale_alpha_discrete(range = c(0.2, 0.8)) +
  coord_cartesian(ylim=c(0,80)) +
  theme_apa() +
  theme(legend.position="right",
        axis.line = element_line(color="black", size = 0.4)) +
  guides(alpha = guide_legend(override.aes = list(
    fill = c("gray80", "gray30"))))

# individual TOD plots
tod.tcds.rand <- ggplot(
  data = subset(quantity.rand_and_tt.all, Sample == "Random"), aes(
  y = round(tds_mph, 0), x = stthr.tri.centered,
  group = interaction(SplitAge, stthr.tri.centered),
  color = Sample,
  fill = Sample,
  alpha = SplitAge)) +
  geom_jitter() +
  geom_boxplot(color = "black") +
  ylab("TCDS (min/hr)") + xlab("")	+
  ggtitle("Random") +
  labs(alpha = "Age") +
  scale_y_continuous(limits=c(-10,40),
                     breaks=c(0,10,20, 30, 40)) +
  scale_color_manual(guide = FALSE, values = viridis(3)) +
  scale_fill_manual(guide = FALSE, values = viridis(3)) +
  scale_alpha_discrete(range = c(0.2, 0.8)) +
  coord_cartesian(ylim=c(0,40)) +
  theme_apa() +
  theme(legend.position="none",
        axis.line = element_line(color="black", size = 0.4),
        plot.title = element_text(hjust = 0.5))

tod.ods.rand <- ggplot(
  data = subset(quantity.rand_and_tt.all, Sample == "Random"), aes(
  y = round(ods_mph, 0), x = stthr.tri.centered,
  group = interaction(SplitAge, stthr.tri.centered),
  color = Sample,
  fill = Sample,
  alpha = SplitAge)) +
  geom_jitter() +
  geom_boxplot(color = "black") +
  ylab("ODS (min/hr)") + xlab("")	+
  ggtitle("Random") +
  labs(alpha = "Age") +
  scale_y_continuous(limits=c(-10,80),
                     breaks=seq(0,80,20)) +
  scale_color_manual(guide = FALSE, values = viridis(3)) +
  scale_fill_manual(guide = FALSE, values = viridis(3)) +
  scale_alpha_discrete(range = c(0.2, 0.8)) +
  coord_cartesian(ylim=c(0,80)) +
  theme_apa() +
  theme(legend.position="none",
        axis.line = element_line(color="black", size = 0.4),
        plot.title = element_text(hjust = 0.5))

tod.tcds.tt <- ggplot(
  data = subset(quantity.rand_and_tt.all, Sample == "Turn taking"), aes(
  y = round(tds_mph, 0), x = stthr.tri.centered,
  group = interaction(SplitAge, stthr.tri.centered),
  color = Sample,
  fill = Sample,
  alpha = SplitAge)) +
  geom_jitter() +
  geom_boxplot(color = "black") +
  ylab("TCDS (min/hr)") + xlab("Time of day")	+
  ggtitle("Turn taking") +
  labs(alpha = "Age") +
  scale_y_continuous(limits=c(-10,40),
                     breaks=c(0,10,20, 30, 40)) +
  scale_color_manual(guide = FALSE,
                     values = c("#21908CFF", "#21908CFF", "#FDE725FF")) +
  scale_fill_manual(guide = FALSE,
                    values = c("#21908CFF", "#21908CFF", "#FDE725FF")) +
  scale_alpha_discrete(range = c(0.2, 0.8)) +
  coord_cartesian(ylim=c(0,40)) +
  theme_apa() +
  theme(legend.position="none",
        axis.line = element_line(color="black", size = 0.4),
        plot.title = element_text(hjust = 0.5))

tod.ods.tt <- ggplot(
  data = subset(quantity.rand_and_tt.all, Sample == "Turn taking"), aes(
  y = round(ods_mph, 0), x = stthr.tri.centered,
  group = interaction(SplitAge, stthr.tri.centered),
  color = Sample,
  fill = Sample,
  alpha = SplitAge)) +
  geom_jitter() +
  geom_boxplot(color = "black") +
  ylab("ODS (min/hr)") + xlab("Time of day")	+
  ggtitle("Turn taking") +
  labs(alpha = "Age") +
  scale_y_continuous(limits=c(-10,80),
                     breaks=seq(0,80,20)) +
  scale_color_manual(guide = FALSE,
                     values = c("#21908CFF", "#21908CFF", "#FDE725FF")) +
  scale_fill_manual(guide = FALSE,
                    values = c("#21908CFF", "#21908CFF", "#FDE725FF")) +
  scale_alpha_discrete(range = c(0.2, 0.8)) +
  coord_cartesian(ylim=c(0,80)) +
  theme_apa() +
  theme(legend.position="none",
        axis.line = element_line(color="black", size = 0.4),
        plot.title = element_text(hjust = 0.5))


### alternate for presentation
# TDS min/hr - zoomed in
tdsmph.segments.rand_and_tt.zoomedin.1 <- ggplot(quantity.rand,
                          aes(x = age_mo_round, y = tds_mph)) +
  geom_boxplot(aes(group = age_mo_round), fill = "gray50", color = "black",
               outlier.shape = NA,
               lty = "solid") +
  geom_smooth(fill = "black", color = "black", method = "lm") +
  ylab("TCDS (min/hr)") + xlab("Child age (mo)")	+
  scale_y_continuous(limits=c(0,40),
                     breaks=seq(0,40,10)) +
  scale_x_continuous(limits=c(0,38),
                     breaks=seq(0,38,6)) +
  coord_cartesian(ylim=c(0,40),xlim=c(0,38)) +
  theme_apa() +
  basic.theme + theme(
		panel.grid.major = element_blank(),
		panel.grid.minor = element_blank(),
		axis.text.x = element_text(color="black"),
	  axis.title.x = element_text(color="black"),
	  axis.text.y = element_text(color="black"),
	  axis.title.y = element_text(color="black"),
	  strip.text = element_text(color="black"),
		axis.ticks = element_line(color = "black"),
		axis.line = element_line(color="black", size = 0.4),
		legend.position = "none")

tdsmph.segments.rand_and_tt.zoomedin.2 <- ggplot(quantity.nonrand.tt,
                          aes(x = age_mo_round, y = tds_mph)) +
  geom_boxplot(aes(group = age_mo_round), fill = "pink", color = "red",
               outlier.shape = NA,
               lty = "solid", alpha = 0.4) +
  geom_smooth(fill = "red", color = "red", method = "lm") +
  ylab("TCDS (min/hr)") + xlab("Child age (mo)")	+
  scale_y_continuous(limits=c(0,40),
                     breaks=seq(0,40,10)) +
  scale_x_continuous(limits=c(0,38),
                     breaks=seq(0,38,6)) +
  coord_cartesian(ylim=c(0,40),xlim=c(0,38)) +
  theme_apa() +
  basic.theme + theme(
		panel.grid.major = element_blank(),
		panel.grid.minor = element_blank(),
		axis.text.x = element_text(color="black"),
	  axis.title.x = element_text(color="black"),
	  axis.text.y = element_text(color="black"),
	  axis.title.y = element_text(color="black"),
	  strip.text = element_text(color="black"),
		axis.ticks = element_line(color = "black"),
		axis.line = element_line(color="black", size = 0.4),
		legend.position = "none")

# png(paste("diff_figs/","tcds.1.png", sep=""),
#     width=500, height=400,units="px", bg = "transparent")
# print(tdsmph.segments.rand_and_tt.zoomedin.1)
# dev.off()
# png(paste("diff_figs/","tcds.2.png", sep=""),
#     width=500, height=400,units="px", bg = "transparent")
# print(tdsmph.segments.rand_and_tt.zoomedin.2)
# dev.off()

odsmph.segments.rand_and_tt.1 <- ggplot(quantity.rand,
                          aes(x = age_mo_round, y = ods_mph)) +
  geom_boxplot(aes(group = age_mo_round), fill = "gray50", color = "black",
               outlier.shape = NA,
               lty = "solid") +
  geom_smooth(fill = "black", color = "black", method = "lm") +
  ylab("ODS (min/hr)") + xlab("Child age (mo)")	+
  scale_y_continuous(limits=c(-10,80),
                     breaks=seq(0,80,20)) +
  scale_x_continuous(limits=c(0,38),
                     breaks=seq(0,38,6)) +
  coord_cartesian(ylim=c(0,80),xlim=c(0,38)) +
  theme_apa() +
  basic.theme + theme(
		panel.grid.major = element_blank(),
		panel.grid.minor = element_blank(),
		axis.text.x = element_text(color="black"),
	  axis.title.x = element_text(color="black"),
	  axis.text.y = element_text(color="black"),
	  axis.title.y = element_text(color="black"),
	  strip.text = element_text(color="black"),
		axis.ticks = element_line(color = "black"),
		axis.line = element_line(color="black", size = 0.4),
		legend.position = "none")

odsmph.segments.rand_and_tt.2 <- ggplot(quantity.nonrand.tt,
                          aes(x = age_mo_round, y = ods_mph)) +
  geom_boxplot(aes(group = age_mo_round), fill = "pink", color = "red",
               outlier.shape = NA,
               lty = "solid") +
  geom_smooth(fill = "red", color = "red", method = "lm") +
  ylab("ODS (min/hr)") + xlab("Child age (mo)")	+
  scale_y_continuous(limits=c(-10,80),
                     breaks=seq(0,80,20)) +
  scale_x_continuous(limits=c(0,38),
                     breaks=seq(0,38,6)) +
  coord_cartesian(ylim=c(0,80),xlim=c(0,38)) +
  theme_apa() +
  basic.theme + theme(
		panel.grid.major = element_blank(),
		panel.grid.minor = element_blank(),
		axis.text.x = element_text(color="black"),
	  axis.title.x = element_text(color="black"),
	  axis.text.y = element_text(color="black"),
	  axis.title.y = element_text(color="black"),
	  strip.text = element_text(color="black"),
		axis.ticks = element_line(color = "black"),
		axis.line = element_line(color="black", size = 0.4),
		legend.position = "none")

# png(paste("diff_figs/","ods.1.png", sep=""),
#     width=500, height=400,units="px", bg = "transparent")
# print(odsmph.segments.rand_and_tt.1)
# dev.off()
# png(paste("diff_figs/","ods.2.png", sep=""),
#     width=500, height=400,units="px", bg = "transparent")
# print(odsmph.segments.rand_and_tt.2)
# dev.off()


```

```{r fig2, echo=FALSE, fig.cap="Estimates of TCDS min/hr (left) and ODS min/hr (right) across the sampled age range. Each box plot summarizes the data for one child from the randomly sampled clips (purple; solid) or the turn taking clips (green; dashed). Bands on the linear trends show 95% confidence intervals.", message=FALSE, warning=FALSE, fig.height=2.5}
grid.arrange(tdsmph.segments.rand_and_tt.zoomedin,
             odsmph.segments.rand_and_tt, nrow=1, ncol=2)
```

```{r tcds_models, message=FALSE, warning=FALSE, paged.print=FALSE}
## TCDS random sample ####
tcds.random.distribution <- ggplot(quantity.rand,
                            aes(round(tds_mph,0))) +
  geom_histogram(binwidth = 2) +
  ylab("# of clips") +
  xlab ("TCDS min/hr") +
  basic.theme
ggsave(paste0(shiny.input.img.path, "TCDS_random_distribution.png"),
       plot = tcds.random.distribution,
       width = 8, height = 6, dpi = 300)
#sd(round(quantity.rand$tds_mph,0))^2
#mean(round(quantity.rand$tds_mph,0))
# mean is much smaller than variance
tds.rand.zinb <- glmmTMB(round(tds_mph,0) ~
                           tchiyr.std +
                           stthr.tri +
                           hsz.std +
                           nsk.std +
                           tchiyr.std:stthr.tri +
                           tchiyr.std:nsk.std +
                           (1|aclew_child_id),
                         data=quantity.rand,
                         ziformula=~nsk.std,
                         family="nbinom1")
#tds.rand.zinb.res = simulateResiduals(tds.rand.zinb)
#plot(tds.rand.zinb.res, rank = T) # (manually saved)
#summary(tds.rand.zinb)
# Data: quantity.rand
# 
#      AIC      BIC   logLik deviance df.resid 
#    416.5    449.0   -195.3    390.5       77 
# 
# Random effects:
# 
# Conditional model:
#  Groups         Name        Variance       Std.Dev.  
#  aclew_child_id (Intercept) 0.000000000797 0.00002823
# Number of obs: 90, groups:  aclew_child_id, 10
# 
# Overdispersion parameter for nbinom1 family (): 3.37 
# 
# Conditional model:
#                               Estimate Std. Error z value Pr(>|z|)   
# (Intercept)                    0.69020    0.31898   2.164  0.03048 * 
# tchiyr.std                     0.73104    0.22844   3.200  0.00137 **
# stthr.trimorning               0.80009    0.35930   2.227  0.02596 * 
# stthr.triafternoon             0.25885    0.35412   0.731  0.46480   
# hsz.std                       -0.20738    0.12268  -1.690  0.09096 . 
# nsk.std                       -0.04380    0.16428  -0.267  0.78976   
# tchiyr.std:stthr.trimorning   -0.58894    0.30302  -1.944  0.05194 . 
# tchiyr.std:stthr.triafternoon -0.59649    0.29170  -2.045  0.04087 * 
# tchiyr.std:nsk.std            -0.02804    0.10818  -0.259  0.79546   
# ---
# Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
# 
# Zero-inflation model:
#             Estimate Std. Error z value Pr(>|z|)
# (Intercept)   -9.281     11.509  -0.806    0.420
# nsk.std       -5.655      7.444  -0.760    0.447
# save for reporting
tds.rand.zinb.disp <- round(sigma(tds.rand.zinb), 2)
tds.rand.zinb.COEF.age <-
  coef(summary(tds.rand.zinb))[[1]]["tchiyr.std",] 
tds.rand.zinb.COEF.midd.morn <-
  coef(summary(tds.rand.zinb))[[1]]["stthr.trimorning",] 
tds.rand.zinb.COEF.midd.aft <-
  coef(summary(tds.rand.zinb))[[1]]["stthr.triafternoon",] 
tds.rand.zinb.COEF.age.midd.morn <-
  coef(summary(tds.rand.zinb))[[1]]["tchiyr.std:stthr.trimorning",]
tds.rand.zinb.COEF.age.midd.aft <-
  coef(summary(tds.rand.zinb))[[1]]["tchiyr.std:stthr.triafternoon",]
tds.rand.zinb.COEF.agensk <-
  coef(summary(tds.rand.zinb))[[1]]["tchiyr.std:nsk.std",]

# test the other two-way effects of time of day
tds.rand.zinb.v2 <- glmmTMB(round(tds_mph,0) ~
                           tchiyr.std +
                           stthr.tri.a +
                           hsz.std +
                           nsk.std +
                           tchiyr.std:stthr.tri.a +
                           tchiyr.std:nsk.std +
                           (1|aclew_child_id),
                         data=quantity.rand,
                         ziformula=~nsk.std,
                         family="nbinom1")
#summary(tds.rand.zinb.v2)
# stthr.tri.amorning             0.541238   0.257256   2.104      0.0354 *  
# tchiyr.std:stthr.tri.amorning  0.007545   0.270156   0.028      0.9777  
# save for reporting
tds.rand.zinb.v2.COEF.aft.morn <-
  coef(summary(tds.rand.zinb.v2))[[1]]["stthr.tri.amorning",] 
tds.rand.zinb.v2.COEF.age.aft.morn <-
  coef(summary(tds.rand.zinb.v2))[[1]]["tchiyr.std:stthr.tri.amorning",] 

## TCDS tt sample ####
tcds.tt.distribution <- ggplot(quantity.nonrand.tt,
                            aes(round(tds_mph,0))) +
  geom_histogram(binwidth = 2) +
  ylab("# of clips") +
  xlab ("TCDS min/hr") +
  basic.theme
ggsave(paste0(shiny.input.img.path, "TCDS_turntaking_distribution.png"),
       plot = tcds.tt.distribution,
       width = 8, height = 6, dpi = 300)
#sd(round(quantity.nonrand.tt$tds_mph,0))^2
#mean(round(quantity.nonrand.tt$tds_mph,0))
# mean is much smaller than variance but reasonably normal
# not zero-inflated (nature of this sample)
tds.tt.nb <- glmmTMB(round(tds_mph,0) ~
                       tchiyr.std +
                       stthr.tri +
                       hsz.std +
                       nsk.std +
                       tchiyr.std:stthr.tri +
                       tchiyr.std:nsk.std +
                       (1|aclew_child_id),
                     data=quantity.nonrand.tt,
                     family="nbinom1")
#tds.tt.nb.res = simulateResiduals(tds.tt.nb)
#plot(tds.tt.nb.res, rank = T) # (manually saved)
#summary(tds.tt.nb)
# Data: quantity.nonrand.tt
# 
#      AIC      BIC   logLik deviance df.resid 
#    388.5    410.6   -183.3    366.5       44 
# 
# Random effects:
# 
# Conditional model:
#  Groups         Name        Variance       Std.Dev.  
#  aclew_child_id (Intercept) 0.000000002313 0.00004809
# Number of obs: 55, groups:  aclew_child_id, 10
# 
# Overdispersion parameter for nbinom1 family (): 2.91 
# 
# Conditional model:
#                               Estimate Std. Error z value  Pr(>|z|)    
# (Intercept)                    2.38897    0.25269   9.454  <0.00002 ***
# tchiyr.std                    -0.62835    0.27007  -2.327  0.0200 *  
# stthr.trimorning               0.21896    0.28390   0.771  0.4406    
# stthr.triafternoon             0.33756    0.27312   1.236  0.2165    
# hsz.std                       -0.02033    0.07661  -0.265  0.7907    
# nsk.std                       -0.04457    0.08565  -0.520  0.6028    
# tchiyr.std:stthr.trimorning    0.53280    0.28184   1.890  0.0587 .  
# tchiyr.std:stthr.triafternoon  0.60509    0.27867   2.171  0.0299 *  
# tchiyr.std:nsk.std            -0.15095    0.11158  -1.353  0.1761    
# save for reporting
tds.tt.nb.disp <- round(sigma(tds.tt.nb), 2)
tds.tt.nb.COEF.age <-
  coef(summary(tds.tt.nb))[[1]]["tchiyr.std",] 
tds.tt.nb.COEF.midd.morn <-
  coef(summary(tds.tt.nb))[[1]]["stthr.trimorning",] 
tds.tt.nb.COEF.midd.aft <-
  coef(summary(tds.tt.nb))[[1]]["stthr.triafternoon",] 
tds.tt.nb.COEF.age.midd.morn <-
  coef(summary(tds.tt.nb))[[1]]["tchiyr.std:stthr.trimorning",]
tds.tt.nb.COEF.age.midd.aft <-
  coef(summary(tds.tt.nb))[[1]]["tchiyr.std:stthr.triafternoon",]
tds.tt.nb.COEF.agensk <-
  coef(summary(tds.tt.nb))[[1]]["tchiyr.std:nsk.std",]

# test the other two-way effects of time of day
tds.tt.nb.v2 <- glmmTMB(round(tds_mph,0) ~
                       tchiyr.std +
                       stthr.tri.a +
                       hsz.std +
                       nsk.std +
                       tchiyr.std:stthr.tri.a +
                       tchiyr.std:nsk.std +
                       (1|aclew_child_id),
                     data=quantity.nonrand.tt,
                     family="nbinom1")
#summary(tds.tt.nb.v2)
# stthr.tri.amorning            -0.11860    0.17254  -0.687  0.4919    
# tchiyr.std:stthr.tri.amorning -0.07229    0.17299  -0.418  0.6760    
# no results to save for reporting

```

```{r tcds_models_gaussian, message=FALSE, warning=FALSE, paged.print=FALSE}
## TCDS random sample ####
tds.rand.gaus <- glmmTMB(log(tds_mph+1) ~
                           tchiyr.std +
                           stthr.tri +
                           hsz.std +
                           nsk.std +
                           tchiyr.std:stthr.tri +
                           tchiyr.std:nsk.std +
                           (1|aclew_child_id),
                         data=quantity.rand)
#tds.rand.gaus.res = simulateResiduals(tds.rand.gaus)
#plot(tds.rand.gaus.res, rank = T) # (manually saved)
#summary(tds.rand.gaus)
# Data: quantity.rand
# 
#      AIC      BIC   logLik deviance df.resid 
#    235.7    263.2   -106.9    213.7       79 
# 
# Random effects:
# 
# Conditional model:
#  Groups         Name        Variance        Std.Dev.  
#  aclew_child_id (Intercept) 0.0000000004793 0.00002189
#  Residual                   0.6292727683638 0.79326715
# Number of obs: 90, groups:  aclew_child_id, 10
# 
# Dispersion estimate for gaussian family (sigma^2): 0.629 
# 
# Conditional model:
#                               Estimate Std. Error z value    Pr(>|z|)    
# (Intercept)                    0.89006    0.17649   5.043 0.000000458 ***
# tchiyr.std                     0.48255    0.17228   2.801      0.0051 ** 
# stthr.trimorning               0.39934    0.23721   1.684      0.0923 .  
# stthr.triafternoon             0.09089    0.21385   0.425      0.6708    
# hsz.std                       -0.11231    0.08887  -1.264      0.2063    
# nsk.std                        0.03082    0.08883   0.347      0.7286    
# tchiyr.std:stthr.trimorning   -0.38600    0.24704  -1.563      0.1182    
# tchiyr.std:stthr.triafternoon -0.40684    0.21689  -1.876      0.0607 .  
# tchiyr.std:nsk.std            -0.02568    0.07849  -0.327      0.7435    
# DIFFERENCES between z-i nb and logged gaussian?
# overall similar (weaker, similar pattern of effects)

# test the other two-way effects of time of day
tds.rand.gaus.v2 <- glmmTMB(log(tds_mph+1) ~
                           tchiyr.std +
                           stthr.tri.a +
                           hsz.std +
                           nsk.std +
                           tchiyr.std:stthr.tri.a +
                           tchiyr.std:nsk.std +
                           (1|aclew_child_id),
                         data=quantity.rand)
#summary(tds.rand.gaus.v2)
# stthr.tri.amorning             0.30846    0.19789   1.559 0.1191    
# tchiyr.std:stthr.tri.amorning  0.02084    0.21705   0.096 0.9235    
# DIFFERENCES between z-i nb and logged gaussian?
# missing effect of stthr.tri.amorning, but similar (smaller) size and direction

## TCDS tt sample ####
tds.tt.gaus <- glmmTMB(log(tds_mph+1) ~
                       tchiyr.std +
                       stthr.tri +
                       hsz.std +
                       nsk.std +
                       tchiyr.std:stthr.tri +
                       tchiyr.std:nsk.std +
                       (1|aclew_child_id),
                     data=quantity.nonrand.tt)
#tds.tt.gaus.res = simulateResiduals(tds.tt.gaus)
#plot(tds.tt.gaus.res, rank = T) # (manually saved)
# Data: quantity.nonrand.tt
# 
#      AIC      BIC   logLik deviance df.resid 
#    110.0    132.1    -44.0     88.0       44 
# 
# Random effects:
# 
# Conditional model:
#  Groups         Name        Variance Std.Dev.
#  aclew_child_id (Intercept) 0.00767  0.08758 
#  Residual                   0.28296  0.53194 
# Number of obs: 55, groups:  aclew_child_id, 10
# 
# Dispersion estimate for gaussian family (sigma^2): 0.283 
# 
# Conditional model:
#                               Estimate Std. Error z value Pr(>|z|)    
# (Intercept)                    2.32434    0.23995   9.687 < 0.0002 ***
# tchiyr.std                    -0.84383    0.24511  -3.443 0.000576 ***
# stthr.trimorning               0.20961    0.29127   0.720 0.471739    
# stthr.triafternoon             0.35976    0.26500   1.358 0.174596    
# hsz.std                       -0.04849    0.08477  -0.572 0.567306    
# nsk.std                       -0.05148    0.08936  -0.576 0.564530    
# tchiyr.std:stthr.trimorning    0.74777    0.25932   2.884 0.003932 ** 
# tchiyr.std:stthr.triafternoon  0.81398    0.25906   3.142 0.001677 ** 
# tchiyr.std:nsk.std            -0.17794    0.12011  -1.481 0.138487    
# DIFFERENCES between z-i nb and logged gaussian?
# broadly similar


# test the other two-way effects of time of day
tds.tt.gaus.v2 <- glmmTMB(log(tds_mph+1) ~
                       tchiyr.std +
                       stthr.tri.a +
                       hsz.std +
                       nsk.std +
                       tchiyr.std:stthr.tri.a +
                       tchiyr.std:nsk.std +
                       (1|aclew_child_id),
                     data=quantity.nonrand.tt)
#summary(tds.tt.gaus.v2)
# stthr.tri.amorning            -0.15015    0.20646  -0.727 0.46708    
# tchiyr.std:stthr.tri.amorning -0.06622    0.20266  -0.327 0.74387    
# DIFFERENCES between z-i nb and logged gaussian?
# broadly similar

# Write model results out for input to shiny
TCDS.models <- bind_rows(
  broom.mixed::tidy(tds.rand.zinb) %>%
    mutate(model = "TCDS_random_z-inb"),
  broom.mixed::tidy(tds.rand.zinb.v2) %>%
    mutate(model = "TCDS_random_z-inb.v2"),
  broom.mixed::tidy(tds.rand.gaus) %>%
    mutate(model = "TCDS_random_log_gaus"),
  broom.mixed::tidy(tds.rand.gaus.v2) %>%
    mutate(model = "TCDS_random_log_gaus.v2"),
  broom.mixed::tidy(tds.tt.nb) %>%
    mutate(model = "TCDS_turntaking_nb"),
  broom.mixed::tidy(tds.tt.nb.v2) %>%
    mutate(model = "TCDS_turntaking_nb.v2"),
  broom.mixed::tidy(tds.tt.gaus) %>%
    mutate(model = "TCDS_turntaking_log_gaus"),
  broom.mixed::tidy(tds.tt.gaus.v2) %>%
    mutate(model = "TCDS_turntaking_log_gaus.v2"))
```

## Target-child-directed speech (TCDS)
In the random sample, these 10 children heard an average of `r round(mean(quantity.rand.bychild$tds_mph),2)` minutes of speech directly addressed to them per hour (median = `r round(median(quantity.rand.bychild$tds_mph),2)`; range = `r round(min(quantity.rand.bychild$tds_mph),2)`--`r round(max(quantity.rand.bychild$tds_mph),2)`; [Figure 2](#fig2) left panel, purple/solid summaries). For comparison, this is slightly less than reported values using a near-identical method of data collection, annotation, and analysis in a Tseltal Mayan community (3.6 minutes per hour for children under 3;0; @casillas2019early) and comparable to what has been reported using a similar method in a Tsimane community [1.6--4.8 minutes per hour for children under 3;0 depending on what speech is counted; @scaffIPlanguage].

The zero-inflated negative binomial regression of TCDS minutes per hour (N = `r nobs(tds.rand.zinb)`, log-likelihood = `r logLik(tds.rand.zinb)[1]`, overdispersion estimate = `r tds.rand.zinb.disp`) suggested significant effects of child age, time of day, and their interaction on the rate at which children are directly addressed. First, the older children heard a small but significantly greater amount of TCDS per hour ([Figure 2](#fig2) left panel purple/solid summaries; B = `r round(tds.rand.zinb.COEF.age[[1]],2)`, SD = `r round(tds.rand.zinb.COEF.age[[2]],2)`, z = `r round(tds.rand.zinb.COEF.age[[3]],2)`, p `r pval.display(tds.rand.zinb.COEF.age[[4]])`). Overall, these children were also more likely to hear TCDS in the mornings ([Figure 3](#fig3) top left panel), with significantly higher TCDS rates in the morning compared to both midday (midday-vs-morning: B = `r round(tds.rand.zinb.COEF.midd.morn[[1]],2)`, SD = `r round(tds.rand.zinb.COEF.midd.morn[[2]],2)`, z = `r round(tds.rand.zinb.COEF.midd.morn[[3]],2)`, p `r pval.display(tds.rand.zinb.COEF.midd.morn[[4]])`) and the afternoon (afternoon-vs-morning: B = `r round(tds.rand.zinb.v2.COEF.aft.morn[[1]],2)`, SD = `r round(tds.rand.zinb.v2.COEF.aft.morn[[2]],2)`, z = `r round(tds.rand.zinb.v2.COEF.aft.morn[[3]],2)`, p `r pval.display(tds.rand.zinb.v2.COEF.aft.morn[[4]])`), and no significant difference in TCDS rate between midday and the afternoon. However, the time-of-day pattern changed with child age. Older children were more likely than younger children to show a peak in TCDS during midday, with a decrease in TCDS between midday and the afternoon (midday-vs-afternoon: B = `r round(tds.rand.zinb.COEF.age.midd.aft[[1]],2)`, SD = `r round(tds.rand.zinb.COEF.age.midd.aft[[2]],2)`, z = `r round(tds.rand.zinb.COEF.age.midd.aft[[3]],2)`, p `r pval.display(tds.rand.zinb.COEF.age.midd.aft[[4]])`) and marginally less TCDS in the morning than at midday (midday-vs-morning: B = `r round(tds.rand.zinb.COEF.age.midd.morn[[1]],2)`, SD = `r round(tds.rand.zinb.COEF.age.midd.morn[[2]],2)`, z = `r round(tds.rand.zinb.COEF.age.midd.morn[[3]],2)`, p `r pval.display(tds.rand.zinb.COEF.age.midd.morn[[4]])`). There were no significant effects in either the count or the zero-inflation models.

``` {r chitcdscorrs, message=FALSE, warning=FALSE, paged.print=FALSE}
# Aggregate to one point per child and then test a correlation with age
# (exclude clips with no TCDS; no way to compute proportion TCDS from kids
# for that clip if there's no TCDS!)
# random
propchitcds.rand <- quantity.rand.sa %>%
  filter(SpkrAge == "Child" & !is.na(prop_sa.tds))
propchitcds.rand.corr_age <- propchitcds.rand %>%
  group_by(aclew_child_id, tchiyr.std, age_mo_round) %>%
  summarise(avg_prpchitcds = mean(prop_sa.tds)) %>%
  mutate(Sample = "Random")
propchitcds.rand.corr_age.test <- cor.test(
  ~ age_mo_round + avg_prpchitcds,
  data = propchitcds.rand.corr_age, method = "spearman")
# turn taking
propchitcds.tt <- quantity.nonrand.tt.sa %>%
  filter(SpkrAge == "Child" & !is.na(prop_sa.tds))
propchitcds.tt.corr_age <- propchitcds.tt %>%
  group_by(aclew_child_id, tchiyr.std, age_mo_round) %>%
  summarise(avg_prpchitcds = mean(prop_sa.tds)) %>%
  mutate(Sample = "Turn taking")
propchitcds.tt.corr_age.test <- cor.test(
  ~ age_mo_round + avg_prpchitcds,
  data = propchitcds.tt.corr_age, method = "spearman")
propchitcds.corr_age.rand_and_tt <- bind_rows(
  propchitcds.rand.corr_age, propchitcds.tt.corr_age)

propchitcds.plot.rand_and_tt <- ggplot(
  propchitcds.corr_age.rand_and_tt,
  aes(x = age_mo_round, y = avg_prpchitcds, lty = Sample)) +
  geom_smooth(aes(fill = Sample, color = Sample), method = "lm") +
  geom_point(aes(color = Sample)) +
  ylab("Mean proportion C-TCDS") + xlab("Child age (mo)")	+
  scale_y_continuous(limits=c(-1,1),
                     breaks=seq(-1,1,0.2)) +
  scale_x_continuous(limits=c(0,38),
                     breaks=seq(0,38,6)) +
  coord_cartesian(ylim=c(0,1),xlim=c(0,38)) +
  scale_color_manual(values = viridis(3)) +
  scale_fill_manual(values = viridis(3)) +
  theme_apa() +
  theme(legend.position="none",
        axis.line = element_line(color="black", size = 0.4))

# proportion of TCDS from adults
# random
propadutcds.rand <- quantity.rand.sa %>%
  filter(SpkrAge == "Adult" & !is.na(prop_sa.tds)) %>%
  group_by(aclew_child_id, tchiyr.std, age_mo_round) %>%
  summarise(avg_prpadutcds = mean(prop_sa.tds))
# turn taking
propadutcds.tt <- quantity.nonrand.tt.sa %>%
  filter(SpkrAge == "Adult" & !is.na(prop_sa.tds)) %>%
  group_by(aclew_child_id, tchiyr.std, age_mo_round) %>%
  summarise(avg_prpadutcds = mean(prop_sa.tds))

# Speech from MA vs. FA
# random
tds.per.seg.rand.age.sx <- all.data %>%
  filter(sample == "random" & speaker != "CHI" &
      grepl("xds@", tier) & val == "T" &
      SpkrAge == "Adult" & SpkrSex != "Not known") %>%
  group_by(aclew_child_id, SpkrSex, segment, segment_dur) %>%
  summarise(tds_min.age.sx = round(sum(dur)/60000,3)) %>%
  spread(SpkrSex, tds_min.age.sx) %>%
  replace_na(list(Female = 0, Male = 0)) %>%
  mutate(FA_percent = Female/(Female + Male)) %>%
  group_by(aclew_child_id) %>%
  summarize(
    avg_FA_percent = mean(FA_percent),
    tot_MA = sum(Male),
    tot_FA = sum(Female),
    tot_percent_FA = tot_FA/(tot_FA + tot_MA)
  ) %>%
  left_join(ptcp.info)
# turn taking
tds.per.seg.tt.age.sx <- all.data %>%
  filter(sample == "turn-taking" & speaker != "CHI" &
      grepl("xds@", tier) & val == "T" &
      SpkrAge == "Adult" & SpkrSex != "Not known") %>%
  group_by(aclew_child_id, SpkrSex, segment, segment_dur) %>%
  summarise(tds_min.age.sx = round(sum(dur)/60000,3)) %>%
  spread(SpkrSex, tds_min.age.sx) %>%
  replace_na(list(Female = 0, Male = 0)) %>%
  mutate(FA_percent = Female/(Female + Male)) %>%
  group_by(aclew_child_id) %>%
  summarize(
    avg_FA_percent = mean(FA_percent),
    tot_MA = sum(Male),
    tot_FA = sum(Female),
    tot_percent_FA = tot_FA/(tot_FA + tot_MA)
  ) %>%
  left_join(ptcp.info)

```

Children heard TCDS from a variety of different speakers. Most TCDS came from adults (mean = `r round(mean(propadutcds.rand$avg_prpadutcds), 4)*100`%, median = `r round(median(propadutcds.rand$avg_prpadutcds), 4)*100`%, range = `r round(min(propadutcds.rand$avg_prpadutcds), 4)*100`--`r round(max(propadutcds.rand$avg_prpadutcds), 4)*100`%). On average, `r round(mean(tds.per.seg.rand.age.sx$tot_percent_FA), 4)*100`% of the total TCDS minutes from adults came from women. However, an increasing quantity of TCDS with age came from child speakers (child-TCDS, e.g., from siblings, cousins, or neighbors; C-TCDS); a Spearman's correlation showed a significant positive relationship between the average proportion of C-TCDS in a clip and target child age (Spearman's _rho_ = `r round(propchitcds.rand.corr_age.test$estimate[[1]],2)`; _p_ = `r round(propchitcds.rand.corr_age.test$p.value[[1]],2)`).

``` {r fig3, echo=FALSE, fig.cap="Estimates of TCDS min/hr (left panels) and ODS min/hr (right panels) across the recorded day in the random clips (top panels) and turn-taking (bottom panels) clips. Each box plot summarizes the data for children age 1;0 and younger (light) or age 1;0 and older (dark) at the given time of day.", message=FALSE, warning=FALSE, fig.height=4}
grid.arrange(tod.tcds.rand, tod.ods.rand,
             tod.tcds.tt, tod.ods.tt, nrow=2, ncol=2)
```

```{r ods_models, message=FALSE, warning=FALSE, paged.print=FALSE}
## ODS random sample ####
ods.random.distribution <- ggplot(quantity.rand,
                            aes(round(ods_mph,0))) +
  geom_histogram(binwidth = 2) +
  ylab("# of clips") +
  xlab ("ODS min/hr") +
  basic.theme
ggsave(paste0(shiny.input.img.path, "ODS_random_distribution.png"),
       plot = ods.random.distribution,
       width = 8, height = 6, dpi = 300)
#sd(round(quantity.rand$ods_mph,0))^2
#mean(round(quantity.rand$ods_mph,0))
# mean is much smaller than variance
# not a huge inflated zero bin, so using nb
ods.rand.nb <- glmmTMB(round(ods_mph,0) ~
                           tchiyr.std +
                           stthr.tri +
                           hsz.std +
                           nsk.std +
                           tchiyr.std:stthr.tri +
                           tchiyr.std:nsk.std +
                           (1|aclew_child_id),
                         data=quantity.rand,
                         family="nbinom1")
#ods.rand.nb.res = simulateResiduals(ods.rand.nb)
#plot(ods.rand.nb.res, rank = T) # (manually saved)
#summary(ods.rand.nb)
# Data: quantity.rand
# 
#      AIC      BIC   logLik deviance df.resid 
#    763.7    791.2   -370.9    741.7       79 
# 
# Random effects:
# 
# Conditional model:
#  Groups         Name        Variance       Std.Dev.  
#  aclew_child_id (Intercept) 0.000000001982 0.00004452
# Number of obs: 90, groups:  aclew_child_id, 10
# 
# Overdispersion parameter for nbinom1 family (): 9.14 
# 
# Conditional model:
#                               Estimate Std. Error z value Pr(>|z|)    
# (Intercept)                    3.25730    0.13578  23.990 < 0.00002 ***
# tchiyr.std                    -0.57083    0.17424  -3.276 0.00105 ** 
# stthr.trimorning               0.19634    0.16469   1.192 0.23318    
# stthr.triafternoon             0.25683    0.15264   1.683 0.09245 .  
# hsz.std                       -0.01817    0.05623  -0.323 0.74660    
# nsk.std                        0.49921    0.04959  10.067 < 0.00002 ***
# tchiyr.std:stthr.trimorning    0.65195    0.20165   3.233 0.00122 ** 
# tchiyr.std:stthr.triafternoon  0.28330    0.19815   1.430 0.15279    
# tchiyr.std:nsk.std             0.04333    0.04987   0.869 0.38487    
# save for reporting
ods.rand.nb.disp <- round(sigma(ods.rand.nb), 2)
ods.rand.nb.COEF.age <-
  coef(summary(ods.rand.nb))[[1]]["tchiyr.std",] 
ods.rand.nb.COEF.midd.morn <-
  coef(summary(ods.rand.nb))[[1]]["stthr.trimorning",] 
ods.rand.nb.COEF.midd.aft <-
  coef(summary(ods.rand.nb))[[1]]["stthr.triafternoon",] 
ods.rand.nb.COEF.nsk <-
  coef(summary(ods.rand.nb))[[1]]["nsk.std",] 
ods.rand.nb.COEF.age.midd.morn <-
  coef(summary(ods.rand.nb))[[1]]["tchiyr.std:stthr.trimorning",]
ods.rand.nb.COEF.age.midd.aft <-
  coef(summary(ods.rand.nb))[[1]]["tchiyr.std:stthr.triafternoon",]

# test the other two-way effects of time of day
ods.rand.nb.v2 <- glmmTMB(round(ods_mph,0) ~
                              tchiyr.std +
                              stthr.tri.a +
                              hsz.std +
                              nsk.std +
                              tchiyr.std:stthr.tri.a +
                              tchiyr.std:nsk.std +
                              (1|aclew_child_id),
                            data=quantity.rand,
                            family="nbinom1")
#ods.rand.nb.v2.res = simulateResiduals(ods.rand.nb.v2)
#summary(ods.rand.nb.v2)
# stthr.tri.amorning            -0.06049    0.12552   -0.48              0.62985    
# tchiyr.std:stthr.tri.amorning  0.36865    0.14760    2.50              0.01250 *  
# save for reporting
ods.rand.nb.v2.COEF.aft.morn <-
  coef(summary(ods.rand.nb.v2))[[1]]["stthr.tri.amorning",] 
ods.rand.nb.v2.COEF.age.aft.morn <-
  coef(summary(ods.rand.nb.v2))[[1]]["tchiyr.std:stthr.tri.amorning",] 

## ODS tt sample ####
ods.tt.distribution <- ggplot(quantity.nonrand.tt,
                            aes(round(ods_mph,0))) +
  geom_histogram(binwidth = 2) +
  ylab("# of clips") +
  xlab ("ODS min/hr") +
  basic.theme
ggsave(paste0(shiny.input.img.path, "ODS_turntaking_distribution.png"),
       plot = ods.tt.distribution,
       width = 8, height = 6, dpi = 300)
#sd(round(quantity.nonrand.tt$ods_mph,0))^2
#mean(round(quantity.nonrand.tt$ods_mph,0))
# mean is much smaller than variance
ods.tt.nb <- glmmTMB(round(ods_mph,0) ~
                         tchiyr.std +
                         stthr.tri +
                         hsz.std +
                         nsk.std +
                         tchiyr.std:stthr.tri +
                         tchiyr.std:nsk.std +
                         (1|aclew_child_id),
                       data=quantity.nonrand.tt,
                       family="nbinom1")
#ods.tt.nb.res = simulateResiduals(ods.tt.nb)
#plot(ods.tt.nb.res, rank = T) # (manually saved)
#summary(ods.tt.nb)
# Data: quantity.nonrand.tt
# 
#      AIC      BIC   logLik deviance df.resid 
#    427.2    449.3   -202.6    405.2       44 
# 
# Random effects:
# 
# Conditional model:
#  Groups         Name        Variance Std.Dev.
#  aclew_child_id (Intercept) 0.0762   0.276   
# Number of obs: 55, groups:  aclew_child_id, 10
# 
# Overdispersion parameter for nbinom1 family (): 4.66 
# 
# Conditional model:
#                               Estimate Std. Error z value Pr(>|z|)    
# (Intercept)                    2.61645    0.33147   7.893 0.0000294 ***
# tchiyr.std                    -0.04506    0.33390  -0.135 0.893    
# stthr.trimorning               0.42969    0.34340   1.251 0.211    
# stthr.triafternoon             0.34822    0.34745   1.002 0.316    
# hsz.std                        0.03336    0.12176   0.274 0.784    
# nsk.std                        0.55972    0.08283   6.757 0.00001405625 ***
# tchiyr.std:stthr.trimorning   -0.14627    0.33242  -0.440 0.660    
# tchiyr.std:stthr.triafternoon  0.02957    0.35086   0.084 0.933    
# tchiyr.std:nsk.std            -0.16430    0.10849  -1.514 0.130    
# save for reporting
ods.tt.nb.disp <- round(sigma(ods.tt.nb), 2)
ods.tt.nb.COEF.age <-
  coef(summary(ods.tt.nb))[[1]]["tchiyr.std",] 
ods.tt.nb.COEF.nsk <-
  coef(summary(ods.tt.nb))[[1]]["nsk.std",] 

# test the other two-way effects of time of day
ods.tt.nb.v2 <- glmmTMB(round(ods_mph,0) ~
                            tchiyr.std +
                            stthr.tri.a +
                            hsz.std +
                            nsk.std +
                            tchiyr.std:stthr.tri.a +
                            tchiyr.std:nsk.std +
                            (1|aclew_child_id),
                          data=quantity.nonrand.tt,
                          family="nbinom1")
#summary(ods.tt.nb.v2)
# no additional results to report
```

```{r ods_models_gaussian, message=FALSE, warning=FALSE, paged.print=FALSE}
## ODS random sample ####
ods.rand.gaus <- glmmTMB(log(ods_mph+1) ~
                           tchiyr.std +
                           stthr.tri +
                           hsz.std +
                           nsk.std +
                           tchiyr.std:stthr.tri +
                           tchiyr.std:nsk.std +
                           (1|aclew_child_id),
                         data=quantity.rand)
#ods.rand.gaus.res = simulateResiduals(ods.rand.gaus)
#plot(ods.rand.gaus.res, rank = T) # (manually saved)
#summary(ods.rand.gaus)
# 
#      AIC      BIC   logLik deviance df.resid 
#    207.9    235.4    -92.9    185.9       79 
# 
# Random effects:
# 
# Conditional model:
#  Groups         Name        Variance Std.Dev.
#  aclew_child_id (Intercept) 0.03863  0.1965  
#  Residual                   0.43258  0.6577  
# Number of obs: 90, groups:  aclew_child_id, 10
# 
# Dispersion estimate for gaussian family (sigma^2): 0.433 
# 
# Conditional model:
#                               Estimate Std. Error z value Pr(>|z|)    
# (Intercept)                    3.06000    0.16289  18.786 < 0.0002 ***
# tchiyr.std                    -0.47822    0.16037  -2.982 0.00286 ** 
# stthr.trimorning               0.25500    0.20333   1.254 0.20979    
# stthr.triafternoon             0.28140    0.18190   1.547 0.12187    
# hsz.std                        0.00308    0.09863   0.031 0.97508    
# nsk.std                        0.68388    0.07758   8.816 < 0.0002 ***
# tchiyr.std:stthr.trimorning    0.57089    0.21118   2.703 0.00687 ** 
# tchiyr.std:stthr.triafternoon  0.09408    0.18304   0.514 0.60728    
# tchiyr.std:nsk.std             0.04193    0.06646   0.631 0.52817    
# DIFFERENCES between z-i nb and logged gaussian?
# broadly similar

# test the other two-way effects of time of day
ods.rand.gaus.v2 <- glmmTMB(log(ods_mph+1) ~
                              tchiyr.std +
                              stthr.tri.a +
                              hsz.std +
                              nsk.std +
                              tchiyr.std:stthr.tri.a +
                              tchiyr.std:nsk.std +
                              (1|aclew_child_id),
                            data=quantity.rand)
#summary(ods.rand.gaus.v2)
# stthr.tri.amorning            -0.026405   0.164904  -0.160 0.87278    
# tchiyr.std:stthr.tri.amorning  0.476814   0.180828   2.637 0.00837 ** 
# save for reporting
# DIFFERENCES between z-i nb and logged gaussian?
# broadly similar

## ODS tt sample ####
ods.tt.gaus <- glmmTMB(log(ods_mph+1) ~
                         tchiyr.std +
                         stthr.tri +
                         hsz.std +
                         nsk.std +
                         tchiyr.std:stthr.tri +
                         tchiyr.std:nsk.std +
                         (1|aclew_child_id),
                       data=quantity.nonrand.tt)
#ods.tt.gaus.res = simulateResiduals(ods.tt.gaus)
#plot(ods.tt.gaus.res, rank = T) # (manually saved)
#summary(ods.tt.gaus)
# Data: quantity.nonrand.tt
# 
#      AIC      BIC   logLik deviance df.resid 
#    130.3    152.3    -54.1    108.3       44 
# 
# Random effects:
# 
# Conditional model:
#  Groups         Name        Variance Std.Dev.
#  aclew_child_id (Intercept) 0.07029  0.2651  
#  Residual                   0.36797  0.6066  
# Number of obs: 55, groups:  aclew_child_id, 10
# 
# Dispersion estimate for gaussian family (sigma^2): 0.368 
# 
# Conditional model:
#                               Estimate Std. Error z value             Pr(>|z|)    
# (Intercept)                    2.55412    0.28624   8.923 < 0.00002 ***
# tchiyr.std                    -0.11827    0.29745  -0.398 0.691    
# stthr.trimorning               0.37439    0.32325   1.158 0.247    
# stthr.triafternoon             0.31226    0.30491   1.024 0.306    
# hsz.std                        0.04490    0.12710   0.353 0.724    
# nsk.std                        0.75446    0.11215   6.727 < 0.00002 ***
# tchiyr.std:stthr.trimorning   -0.06997    0.29516  -0.237 0.813    
# tchiyr.std:stthr.triafternoon  0.20963    0.29913   0.701 0.483    
# tchiyr.std:nsk.std            -0.19908    0.14489  -1.374 0.169    
# DIFFERENCES between z-i nb and logged gaussian?
# broadly similar

# test the other two-way effects of time of day
ods.tt.gaus.v2 <- glmmTMB(log(ods_mph+1) ~
                            tchiyr.std +
                            stthr.tri.a +
                            hsz.std +
                            nsk.std +
                            tchiyr.std:stthr.tri.a +
                            tchiyr.std:nsk.std +
                            (1|aclew_child_id),
                          data=quantity.nonrand.tt)
#summary(ods.tt.gaus.v2)
# stthr.tri.amorning             0.06213    0.22016   0.282 0.778    
# tchiyr.std:stthr.tri.amorning -0.27960    0.22418  -1.247 0.212    
# DIFFERENCES between z-i nb and logged gaussian?
# broadly similar

# Write model results out for input to shiny
ODS.models <- bind_rows(
  broom.mixed::tidy(ods.rand.nb) %>%
    mutate(model = "ODS_random_nb"),
  broom.mixed::tidy(ods.rand.nb.v2) %>%
    mutate(model = "ODS_random_nb.v2"),
  broom.mixed::tidy(ods.rand.gaus) %>%
    mutate(model = "ODS_random_log_gaus"),
  broom.mixed::tidy(ods.rand.gaus.v2) %>%
    mutate(model = "ODS_random_log_gaus.v2"),
  broom.mixed::tidy(ods.tt.nb) %>%
    mutate(model = "ODS_turntaking_nb"),
  broom.mixed::tidy(ods.tt.nb.v2) %>%
    mutate(model = "ODS_turntaking_nb.v2"),
  broom.mixed::tidy(ods.tt.gaus) %>%
    mutate(model = "ODS_turntaking_log_gaus"),
  broom.mixed::tidy(ods.tt.gaus.v2) %>%
    mutate(model = "ODS_turntaking_log_gaus.v2"))
```

## Other-directed speech (ODS)
In the random sample, these children heard an average of `r round(mean(quantity.rand.bychild$ods_mph),2)` minutes of other-directed speech per hour ([Figure 2](#fig2) right panel, purple/solid summaries; median = `r round(median(quantity.rand.bychild$ods_mph),2)`; range = `r round(min(quantity.rand.bychild$ods_mph),2)`--`r round(max(quantity.rand.bychild$ods_mph),2)`): that is more than eleven times the average quantity of speech directed to them, with many clips displaying near-continuous background speech. For comparison, the prior estimate for Tseltal children using near-parallel methods found an average of 21 minutes of overhearable speech per hour [@casillas2019early], and a recent study of North American children's daylong recordings found that adult-directed speech (a subset of ODS) occurred at a rate of 7.3 minutes per hour [@bergelson2019day].

The negative binomial regression of other-directed speech rate (N = `r nobs(ods.rand.nb)`, log-likelihood = `r logLik(ods.rand.nb)[1]`, overdispersion estimate = `r ods.rand.nb.disp`) revealed effects of child age, number of speakers present, and time of day on the rate of ODS encountered. The rate of ODS significantly decreased with child age ([Figure 2](#fig2) right panel, purple/solid summaries; B = `r round(ods.rand.nb.COEF.age[[1]],2)`, SD = `r round(ods.rand.nb.COEF.age[[2]],2)`, z = `r round(ods.rand.nb.COEF.age[[3]],2)`, p `r pval.display(ods.rand.nb.COEF.age[[4]])`) and significantly increased in the presence of more speakers (B = `r round(ods.rand.nb.COEF.nsk[[1]],2)`, SD = `r round(ods.rand.nb.COEF.nsk[[2]],2)`, z = `r round(ods.rand.nb.COEF.nsk[[3]],2)`, p `r pval.display(ods.rand.nb.COEF.nsk[[4]])`). Across the randomly selected clips, there were an average of `r round(mean(quantity.rand$n_spkrs_clip), 2)` speakers present other than the target child (median = `r round(median(quantity.rand$n_spkrs_clip),2)`; range = `r round(min(quantity.rand$n_spkrs_clip),2)`--`r round(max(quantity.rand$n_spkrs_clip),2)`), an average of `r round(mean(perc_CHI_nspkrs_per_clip$perc_ADU),4)*100`% of whom were adults. Comparing again to Tseltal and North American English, in which the average number of speakers present, not including the target child, was 3.44 and 3.9 respectively [@bergelson2019day; @casillas2019early], we can infer that the increased rate of ODS on Rossel Island is due in part to there simply being more speakers present. Time-of-day effects on ODS only came through in an interaction with child age ([Figure 3](#fig3) top right panel). In particular, older children heard a pattern of ODS mirroring the general pattern of TCDS; significantly more ODS in the mornings compared to midday (midday-vs-morning: B = `r round(ods.rand.nb.COEF.age.midd.morn[[1]],2)`, SD = `r round(ods.rand.nb.COEF.age.midd.morn[[2]],2)`, z = `r round(ods.rand.nb.COEF.age.midd.morn[[3]],2)`, p `r pval.display(ods.rand.nb.COEF.age.midd.morn[[4]])`) and the afternoon (afternoon-vs-morning:  B = `r round(ods.rand.nb.v2.COEF.age.aft.morn[[1]],2)`, SD = `r round(ods.rand.nb.v2.COEF.age.aft.morn[[2]],2)`, z = `r round(ods.rand.nb.v2.COEF.age.aft.morn[[3]],2)`, p `r pval.display(ods.rand.nb.v2.COEF.age.aft.morn[[4]])`). There were no other significant effects on ODS rate.

In sum, the random baseline rates of TCDS and ODS in children's speech environments are influenced by child age (TCDS increases, ODS decreases), time of day (both generally peak in the morning), and their interaction (older children hear more TCDS and less ODS than younger children at midday). The rate of ODS is also impacted by the number of speakers present. Correlational results suggest that TCDS comes increasingly from other children over the first three years. That said, the baseline rate of TCDS is low, on par with estimates in other small-scale rural communities [@casillas2019early; @scaffIPlanguage], while the ODS rate is quite high relative to estimates in prior work.

## TCDS and ODS during interactional peaks
If we instead investigate the rates of TCDS and ODS encountered by these children during interactional peaks, a different picture emerges ([Figures 2](#fig2) and [3](#fig3) green/dashed summaries). The children heard much more TCDS in the turn-taking clips---`r round(mean(subset(quantity.nonrand.bychild, sample == "turn-taking")$tds_mph),2)` min/hr; more than four times the rate of TCDS in the random baseline ([Figure 2](#fig2), left panel, green/dashed summaries; median = `r round(median(subset(quantity.nonrand.bychild, sample == "turn-taking")$tds_mph),2)`; range = `r round(min(subset(quantity.nonrand.bychild, sample == "turn-taking")$tds_mph),2)`--`r round(max(subset(quantity.nonrand.bychild, sample == "turn-taking")$tds_mph),2)`). Children also heard a reduced rate of ODS: `r round(mean(subset(quantity.nonrand.bychild, sample == "turn-taking")$ods_mph),2)` min/hr (`r round((round(mean(subset(quantity.nonrand.bychild, sample == "turn-taking")$ods_mph),2)/round(mean(quantity.rand.bychild$ods_mph),2))*100, 2)`% of the random-sample ODS rate, [Figure 2](#fig2), right panel, green/dashed summaries; median = `r round(median(subset(quantity.nonrand.bychild, sample == "turn-taking")$ods_mph),2)`; range = `r round(min(subset(quantity.nonrand.bychild, sample == "turn-taking")$ods_mph),2)`--`r round(max(subset(quantity.nonrand.bychild, sample == "turn-taking")$ods_mph),2)`).

The negative binomial mixed-effects regression of TCDS (N = `r nobs(tds.tt.nb)`, log-likelihood = `r logLik(tds.tt.nb)[1]`, overdispersion estimate = `r tds.tt.nb.disp`) revealed a significant decrease with child age (B = `r round(tds.tt.nb.COEF.age[[1]],2)`, SD = `r round(tds.tt.nb.COEF.age[[2]],2)`, z = `r round(tds.tt.nb.COEF.age[[3]],2)`, p `r  pval.display(tds.tt.nb.COEF.age[[4]])`) and a significant interaction between child age and time of day; TCDS rate during interactional peaks was marginally higher for older children at morning compared to midday (midday-vs-morning: B = `r round(tds.tt.nb.COEF.age.midd.morn[[1]],2)`, SD = `r round(tds.tt.nb.COEF.age.midd.morn[[2]],2)`, z = `r round(tds.tt.nb.COEF.age.midd.morn[[3]],2)`, p `r  pval.display(tds.tt.nb.COEF.age.midd.morn[[4]])`) and significantly higher in the afternoon than at midday (midday-vs-afternoon: B = `r round(tds.tt.nb.COEF.age.midd.aft[[1]],2)`, SD = `r round(tds.tt.nb.COEF.age.midd.aft[[2]],2)`, z = `r round(tds.tt.nb.COEF.age.midd.aft[[3]],2)`, p `r  pval.display(tds.tt.nb.COEF.age.midd.aft[[4]])`; see [Figure 3](#fig3), bottom left panel).

As in the random sample, an increasing portion of TCDS during interactional peaks came from other children with age. While, overall, more of the TCDS in interactional peaks came from adults than in the random clips (mean = `r round(mean(propadutcds.tt$avg_prpadutcds), 4)*100`%, median = `r round(median(propadutcds.tt$avg_prpadutcds), 4)*100`%, range = `r round(min(propadutcds.tt$avg_prpadutcds), 4)*100`--`r round(max(propadutcds.tt$avg_prpadutcds), 4)*100`%), a Spearman's correlation showed an even stronger positive relationship between the average proportion of child TCDS in a clip and target child age (Spearman's _rho_ = `r round(propchitcds.tt.corr_age.test$estimate[[1]],2)`; _p_ = `r pval.display(propchitcds.tt.corr_age.test$p.value[[1]])`). Notably, women contributed proportionally less TCDS during interactional peaks than they did during the random clips: on average, women contributed `r round(mean(tds.per.seg.tt.age.sx$tot_percent_FA), 4)*100`% of the children's TCDS minutes from adults in the turn-taking clips (compared to `r round(mean(tds.per.seg.rand.age.sx$tot_percent_FA), 4)*100`% in the random clips). In brief, compared to the random sample, interactional peaks included more directed speech from men and, for older target children, more directed speech from other children.

The negative binomial mixed-effects regression of ODS (N = `r nobs(ods.tt.nb)`, log-likelihood = `r logLik(ods.tt.nb)[1]`, overdispersion estimate = `r ods.tt.nb.disp`) only revealed a significant effect of number of speakers. As before, ODS rates were higher when more speakers were present (B = `r round(ods.tt.nb.COEF.nsk[[1]],2)`, SD = `r round(ods.tt.nb.COEF.nsk[[2]],2)`, z = `r round(ods.tt.nb.COEF.nsk[[3]],2)`, p `r  pval.display(ods.tt.nb.COEF.nsk[[4]])`). There were no other significant effects on ODS rate ([Figure 3](#fig3), bottom right panel).

Overall, the results suggest that these children typically hear very little directly addressed speech, but that interactional peaks provide opportunities for dense input. While the majority of directed speech comes from women, an increasing portion of it comes from other children with age, and directed speech from men is more likely during interactional peaks. Directed and overhearable speech are most likely to occur during the morning, before most of the household has dispersed for their work activities, similar to other findings from subsistence farming households [@casillas2019early]. However, older children are more likely than younger children to show higher input rates at midday, perhaps due to their increased interactions with other children while adults attend to gardening and domestic tasks. Possibly because of the large number of speakers present, these children were also in the vicinity of voluminous overhearable speech, underscoring the availability of other-addressed speech as a resource for linguistic input in this context.

``` {r all_model_tables, message=FALSE, warning=FALSE, paged.print=FALSE}
all.models <- bind_rows(TCDS.models, ODS.models)
write_csv(all.models, paste0(shiny.input.path, "all_model_tables.csv"))
```

## Vocal maturity
``` {r vocmat_prep, message=FALSE, warning=FALSE, paged.print=FALSE}
# all vocalization types
chi.vm.lx.utts <- all.data %>%
  filter(
    (tier == "vcm@CHI" |
        tier == "lex@CHI" |
        tier == "mwu@CHI") &
      !is.na(val)) %>%
  mutate(voc.rating = case_when(
    val == "M" ~ 4,
    val == "1" | val == "W" ~ 3,
    val == "C" ~ 2,
    # since the intial Tseltal-CLE analysis, lex = '0' is
    # no longer informative about babble type so it gets
    # a minimum value (equal to non-canonical babble)
    # this doesn't affect the current analysis since
    # we take the maximum score for an utterance below
    # so if it's N+0, it'll be 1, if it's C+0, it'll be 2
    val == "0" | val == "N" ~ 1,
    TRUE ~ 0 # includes crying, laughing, unsure
  )) %>%
  filter(voc.rating > 0) %>%
  group_by(aclew_child_id, segment, sample, start) %>%
  summarise(max_voc.rtg = max(voc.rating))
all.voc.types.per.child <- tibble(
  aclew_child_id = rep(ptcp.info$aclew_child_id, 4),
  max_voc.rtg = c(rep(1, length(ptcp.info$aclew_child_id)),
                  rep(2, length(ptcp.info$aclew_child_id)),
                  rep(3, length(ptcp.info$aclew_child_id)),
                  rep(4, length(ptcp.info$aclew_child_id)))
)
chi.nvocs <- chi.vm.lx.utts %>%
  group_by(aclew_child_id) %>%
  summarise(n_vocs = n())
chi.vm.lx.voc.type.props <- chi.vm.lx.utts %>%
  group_by(aclew_child_id, max_voc.rtg) %>%
  summarise(n_voc.type = n()) %>%
  full_join(all.voc.types.per.child, by = c("aclew_child_id", "max_voc.rtg")) %>%
  replace_na(list(n_voc.type = 0)) %>%
  full_join(chi.nvocs, by = "aclew_child_id") %>%
  mutate(prop_voc.type = round(n_voc.type/n_vocs, 3)) %>%
  arrange(aclew_child_id, max_voc.rtg) %>%
  full_join(ptcp.info, by = "aclew_child_id")
```

``` {r vocmat_plots, message=FALSE, warning=FALSE, paged.print=FALSE}
chi.vm.lx.voc.type.props <- chi.vm.lx.voc.type.props %>%
  mutate(voc.type = factor(as.factor(max_voc.rtg),
                           labels = c("NCB", "CB", "SW", "MW")))

write_csv(chi.vm.lx.voc.type.props,
          paste0(shiny.input.path,
                 "all_vocmat-types_proportions.csv"))

chi.vm.lx.voc.type.SLprops <- chi.vm.lx.voc.type.props %>%
  mutate(speech.like = ifelse(max_voc.rtg < 2, 0, 1)) %>%
  group_by(aclew_child_id, speech.like) %>%
  summarize(
    n_voc.type.SL = sum(n_voc.type),
    n_vocs = min(n_vocs)
  ) %>%
  left_join(ptcp.info)

CBR.by.ptcp <- chi.vm.lx.voc.type.SLprops %>%
  filter(speech.like == 1) %>%
  group_by(aclew_child_id, age_mo_round) %>%
  summarize(SL.prop = n_voc.type.SL/n_vocs) %>%
  arrange(age_mo_round)  

voc.mat.by.age <- ggplot(
  data = chi.vm.lx.voc.type.props,
  aes(x = age_mo_round, y = prop_voc.type, group = as.factor(voc.type))) +
  geom_point(aes(color = as.factor(voc.type))) +
  geom_smooth(aes(color = as.factor(voc.type),
                  fill = as.factor(voc.type)), method = "loess") +
  ylab("Prop of linguistic vocs") + xlab("Child age (mo)") +
  labs(fill='Voc type') +
  labs(color='Voc type') +
  scale_color_manual(values = c("red", "orange",
                                  "green", "blue")) +
  scale_fill_manual(values = c("red", "orange",
                                  "green", "blue")) +
  # scale_color_manual(values = c("gray80", "gray54",
  #                                 "gray27", "black")) +
  # scale_fill_manual(values = c("gray80", "gray54",
  #                                 "gray27", "black")) +
  scale_y_continuous(limits=c(-0.5,1.5),
                     breaks=seq(0,1,0.2)) +
  scale_x_continuous(limits=c(0,38),
                     breaks=seq(0,38,6)) +
  coord_cartesian(ylim=c(0,1), xlim=c(0,38)) +
  theme_apa() + theme(
    legend.position = c(0.9, 0.85),
    legend.background = element_rect(fill="transparent"),
    axis.line = element_line(color="black", size = 0.4))

voc.mat.by.age.1 <- ggplot(
    data = subset(chi.vm.lx.voc.type.props, voc.type == "NCB"),
    aes(x = age_mo_round, y = prop_voc.type)) +
  geom_point(color = "red") +
  geom_smooth(color = "red", fill = "red", method = "loess") +
  ylab("Prop of linguistic vocs") + xlab("Child age (mo)") +
  scale_y_continuous(limits=c(-0.5,1.5),
                     breaks=seq(0,1,0.2)) +
  scale_x_continuous(limits=c(0,38),
                     breaks=seq(0,38,6)) +
  coord_cartesian(ylim=c(0,1), xlim=c(0,38)) +
  theme_apa() +
  basic.theme + theme(
	panel.grid.major = element_blank(),
	panel.grid.minor = element_blank(),
	axis.text.x = element_text(color="black"),
	axis.title.x = element_text(color="black"),
	axis.text.y = element_text(color="black"),
	axis.title.y = element_text(color="black"),
	strip.text = element_text(color="black"),
	axis.ticks = element_line(color = "black"),
	axis.line = element_line(color="black", size = 0.4),
	legend.position = "none")

voc.mat.by.age.2 <- ggplot(
    data = subset(chi.vm.lx.voc.type.props, voc.type == "CB"),
    aes(x = age_mo_round, y = prop_voc.type)) +
  geom_point(color = "orange") +
  geom_smooth(color = "orange", fill = "orange", method = "loess") +
  ylab("Prop of linguistic vocs") + xlab("Child age (mo)") +
  scale_y_continuous(limits=c(-0.5,1.5),
                     breaks=seq(0,1,0.2)) +
  scale_x_continuous(limits=c(0,38),
                     breaks=seq(0,38,6)) +
  coord_cartesian(ylim=c(0,1), xlim=c(0,38)) +
  theme_apa() +
  basic.theme + theme(
	panel.grid.major = element_blank(),
	panel.grid.minor = element_blank(),
	axis.text.x = element_text(color="black"),
	axis.title.x = element_text(color="black"),
	axis.text.y = element_text(color="black"),
	axis.title.y = element_text(color="black"),
	strip.text = element_text(color="black"),
	axis.ticks = element_line(color = "black"),
	axis.line = element_line(color="black", size = 0.4),
	legend.position = "none")

voc.mat.by.age.3 <- ggplot(
    data = subset(chi.vm.lx.voc.type.props, voc.type == "SW"),
    aes(x = age_mo_round, y = prop_voc.type)) +
  geom_point(color = "green") +
  geom_smooth(color = "green", fill = "green", method = "loess") +
  ylab("Prop of linguistic vocs") + xlab("Child age (mo)") +
  scale_y_continuous(limits=c(-0.5,1.5),
                     breaks=seq(0,1,0.2)) +
  scale_x_continuous(limits=c(0,38),
                     breaks=seq(0,38,6)) +
  coord_cartesian(ylim=c(0,1), xlim=c(0,38)) +
  theme_apa() +
  basic.theme + theme(
	panel.grid.major = element_blank(),
	panel.grid.minor = element_blank(),
	axis.text.x = element_text(color="black"),
	axis.title.x = element_text(color="black"),
	axis.text.y = element_text(color="black"),
	axis.title.y = element_text(color="black"),
	strip.text = element_text(color="black"),
	axis.ticks = element_line(color = "black"),
	axis.line = element_line(color="black", size = 0.4),
	legend.position = "none")

voc.mat.by.age.4 <- ggplot(
    data = subset(chi.vm.lx.voc.type.props, voc.type == "MW"),
    aes(x = age_mo_round, y = prop_voc.type)) +
  geom_point(color = "blue") +
  geom_smooth(color = "blue", fill = "blue", method = "loess") +
  ylab("Prop of linguistic vocs") + xlab("Child age (mo)") +
  scale_y_continuous(limits=c(-0.5,1.5),
                     breaks=seq(0,1,0.2)) +
  scale_x_continuous(limits=c(0,38),
                     breaks=seq(0,38,6)) +
  coord_cartesian(ylim=c(0,1), xlim=c(0,38)) +
  theme_apa() +
  basic.theme + theme(
	panel.grid.major = element_blank(),
	panel.grid.minor = element_blank(),
	axis.text.x = element_text(color="black"),
	axis.title.x = element_text(color="black"),
	axis.text.y = element_text(color="black"),
	axis.title.y = element_text(color="black"),
	strip.text = element_text(color="black"),
	axis.ticks = element_line(color = "black"),
	axis.line = element_line(color="black", size = 0.4),
	legend.position = "none")

# png(paste("diff_figs/","vocmat.1.png", sep=""),
#     width=600, height=400,units="px", bg = "transparent")
# print(voc.mat.by.age.1)
# dev.off()
# png(paste("diff_figs/","vocmat.2.png", sep=""),
#     width=600, height=400,units="px", bg = "transparent")
# print(voc.mat.by.age.2)
# dev.off()
# png(paste("diff_figs/","vocmat.3.png", sep=""),
#     width=600, height=400,units="px", bg = "transparent")
# print(voc.mat.by.age.3)
# dev.off()
# png(paste("diff_figs/","vocmat.4.png", sep=""),
#     width=600, height=400,units="px", bg = "transparent")
# print(voc.mat.by.age.4)
```

Given the low baseline rate of directed speech, one might expect that Rossel children’s early linguistic development, particularly the onset and use of single- and multi-word utterances, shows delays in comparison to children growing up in more CDS-rich environments. We plotted the proportion of all linguistic vocalizations for each child (i.e., discarding laughter, crying, or unknown-types; leaving a total of `r sum(chi.nvocs$n_vocs)` vocalizations) that fell into the following categories:  non-canonical babble, canonical babble, single-word utterance, or multi-word utterance. Children are expected to traverse all four types of vocalization during development such that they primarily produce single- and multi-word utterances by age three.

In the onset of use for canonical babble, first words, and multi-word utterances, these Rossel children's vocalization data closely resemble expectations based on populations of children who hear more CDS ([Figure 4](#fig4)). Canonical babble appears in the second half of the first year, first words appear around the first birthday, and multi-word utterances appear a few months after that [@frankIPvariability; @kuhl2004early; @pine1993reanalysing; @slobin1970universals; @tomasello1999early; @warlaumont2014social]. Rossel children also far exceeded the canonical babbling ratio (CBR) associated with major developmental delay [proportional use of speech-like vocalizations > 0.15 by 0;10; @cychoszURcanonical; @oller1995extreme]; the minimum CBR among Rossel children 0;9 and older was `r round(subset(CBR.by.ptcp, age_mo_round == 9)$SL.prop,2)` (mean = `r round(mean(subset(CBR.by.ptcp, age_mo_round >= 9)$SL.prop),2)`; median = `r round(median(subset(CBR.by.ptcp, age_mo_round >= 9)$SL.prop),2)`; range =  `r round(min(subset(CBR.by.ptcp, age_mo_round >= 9)$SL.prop),2)`--`r round(max(subset(CBR.by.ptcp, age_mo_round >= 9)$SL.prop),2)`).

Over all annotated clips, children produced an average of `r round(mean(chi.nvocs$n_vocs)/60,2)` linguistic vocalizations per minute (median = `r round(median(chi.nvocs$n_vocs)/60,2)`; range = `r round(min(chi.nvocs$n_vocs)/60,2)`--`r round(max(chi.nvocs$n_vocs)/60,2)`), less frequently than children in short recordings of American infant-caregiver interaction [@oller1995extreme] but similar to estimates for Tseltal children [@brown2011cultural; @casillas2019early].

```{r fig4, echo=FALSE, fig.cap="Proportion of vocalization types used by children across age (NCB = Non-canonical babble, CB = Canonical babble, SW = single word utterance, MW = multi-word utterance).", message=FALSE, warning=FALSE, fig.height=3.5}
voc.mat.by.age
```

# Discussion {#disc}
We analyzed the speech environments of 10 Rossel children under age 3;0 to investigate: (a) how often children were spoken to directly, (b) how much other overhearable speech is available to them, (c) how these sources of linguistic input are shaped by child age and interactional context, and (d) whether this (relatively) low rate of directed input appears to impact their early production milestones.

Based on prior ethnographic work, we expected that these children would hear frequent child-directed speech from a wide variety of caregivers and frequent speech directed to others [@brownIPchildrearing]. In fact, in these daylong audio recordings, children were rarely directly addressed. This low baseline rate of TCDS is comparable to that found in a Tseltal community where minimal TCDS is one means to socializing children into attending to their surroundings. On the other hand, the Rossel child speech environment contains ample overhearable speech; much more than has been reported elswhere, at time of writing. The low relative rate of TCDS and the high incidence of ODS may be partly attributable to the fact that several speakers are typically present across the day, as discussed further below.

Prior work also led us to expect that the quantity of TCDS would be stable across the age range studied [@bergelsoncasillas2019what; @casillas2019early; @scaffIPlanguage], and that an increasing proportion of it would come from other children [@brown2011cultural; @brownIPchildrearing; @shneidman2012language]. Counter to expectations, we found a small but significant increase in TCDS rate with child age in the random clips and a small and significant _decrease_ in TCDS rate with age in the turn-taking clips. The age-related baseline increase in TCDS may derive from more frequent participation in independent play with other children; in prior work, increased proportional input from other children was also associated with an increase in overall input rate [@shneidman2012language]. The age-related decrease in TCDS rate during peak interactional moments was not expected, but may be attributable to this change in interactional partners with age; if adults are more likely to be the source of TCDS during interactional peaks for younger children, they may also provide more voluminous speech during those peaks than other children do during interactional peaks later in development. Sleep during the day may also help explain these patterns; if older children sleep less than younger children, they may be more likely hear more TCDS during random but not peak-based clips. All of these explanations require follow-up work from a larger sample of children and, ideally, from a larger sample of their interactions throughout the day. ODS decreased with age, consistent with prior Panoramic studies with both Western and non-Western samples [@bergelsoncasillas2019what; @casillas2019early; @scaffIPlanguage].

Finally, while we anticipated that the children's input would be non-uniformly distributed over the recording day [@abney2017time; @casillas2019early], we also expected to see a somewhat more even distribution of directed speech from morning to evening. Young Rossel children have been reported to pass between multiple caregivers during a typical day. We expected that this care-sharing practice might weaken the effect of farming activities on linguistic input rate, found in the late morning and early afternoon in previous work with Tseltal Mayan subsistence farmers [@casillas2019early]. In fact, we found that children's rate of linguistic input was still significantly impacted by time of day, similar to the Tseltal farmers: most TCDS and ODS came during the morning, with older children more likely to hear TCDS at midday than younger children, possibly because midday is when most adults are likely attending to other duties while children congregate in large play groups.

<!--
- reorganize the below to address each of the following points in order
- ideology vs. lifestyle
- use of peaks as indices into ideology (minimize close vs. panoramic bits)
- milestones
-->

## Diverging Close Study and Panoramic perspectives
We predicted that infants on Rossel Island would hear more frequent directed speech than has been found in other subsistence farming contexts [e.g., @brown2011cultural; @brown2014interactional; @brownIPchildrearing; @casillas2019early; @deleon2000emergent; @frye2019thesis; @ochs1984language; @pye1986quiche; @rumsey2013ergative]. We made this prediction on the basis of two prior ethnographic observations (see Brown & Casillas [-@brownIPchildrearing] for details). First, Rossel adults and children have been shown to talk to children, even young infants, as if they can understand and respond to what is being said. Second, infants and young children often traverse a wide network of caregivers who are available to interact with them for some period. Our Panoramic findings, based on daylong audio data from 10 children, differ from these expectations: there is minimal TCDS to young children, time of day strongly impacts the rate of linguistic input, and there is limited variability in the type of speakers typically talking to children.

We found that the 10 Rossel children here heard slightly less TCDS than was documented for the Tseltal children. Taking the Mayan and Papuan findings together, we suggest that the Panoramic approach is not effective for distinguishing distinct caregiver attitudes toward talking to young children. While Rossel caregivers view their children, even their young infants, as potential co-interactants in conversational play [@brownIPchildrearing], the circumstances of everyday life shape the children's broader linguistic landscape such that most of what children hear is talk between others. We suggest that, in the daylong context, caregivers from these two subsistence farming communities are preoccupied for most of the day with social and domestic commitments in which they are motivated to converse with the other adults and (older) children present; not just to get their daily tasks done but also because these more mature speakers enable more complex verbal interactions and social routines. Given the multi-generational and patrilocal settlement patterns in both communities, there are frequent opportunities to engage with other adults and older children. This same explanation extends to the variability in linguistic input encountered by children over the day and from different speaker types; rather than being passed between caregivers who are 'available' to interact with them, young children may accompany their varied caregivers in their shared daily tasks, switching from lap to lap without the activity context necessarily changing.

When it comes to quantifying how much linguistic input children encounter, the Panoramic view yields the important insight that direct linguistic input is rare on average; it exists primarily during short interactional peaks. We suspect that it is during these interactional peaks that caregiver attitudes about how to engage children in interaction are most clearly expressed. Indeed it is during interactional peaks when we see not only more TCDS but also TCDS from more diverse speaker types. In contrast, the randomly sampled Panoramic data demonstrate how the number of speakers present and the routines of everyday life strongly shape the overall rate of linguistic input available in children's environments. That is, the forces shaping the rate of Rossel children’s linguistic input are somewhat different from the forces shaping the content and sources of their linguistic input. This insight is critical in trying to join cognitive and social models of children's early language development. After all, children---particularly children in contexts with minimal TCDS---may do most of their language learning during these short bursts in the day when they are jointly attending to language during interactions with others. If so, it would be more efficient to aim models of learning and annotation time at these interactional peaks. Indeed, such a hybrid approach may be optimal for accessing varied, ecologically valid, culturally distinct codes of verbal interaction while also sketching a stable picture of early language exposure specific to those same communities [@shneidman2010language; @shneidman2012language]. Further cross-cultural work on children's ability to learn from massed vs. distributed and directed vs. overhearable language use [e.g., @akhtar2001learning; @schwab2016repetition]<!--[@shneidmanIPoverhearing]--> is a critical route for further investigation into how these sources of linguistic input may be leveraged for language development.

## Independence and child-TCDS
The increase in TCDS from other children in this Rossel data recalls findings from Shneidman and Goldin-Meadow [-@shneidman2012language] in which Yucatec Mayan children's directed speech rate increased enormously between ages one and three, primarily due to increased input from other children. We saw a significant, but much smaller overall increase in TCDS in these 10 Rossel children's recordings, with an increasing proportion of that input coming from children. Interestingly, prior work with a Tseltal community---culturally more proximal to the Yucatec families studied in Shneidman and Goldin-Meadow [-@shneidman2012language]---found no evidence for increased input from other children in this same age range [0;0--3;0; @casillas2019early]. The lack of child TCDS in the study of Tseltal Mayan children was attributed to the observation that  they only begin to engage in independent, extended play with other children _after_ age three. In comparison, prior ethnographic work on Rossel Island highlights independence as a primary concern for parents of young children; from early toddlerhood Rossel children are encouraged to choose how they dress, when and what to eat, and who to visit [@brownIPchildrearing]. The formation of hamlets in a cluster around a shared open area, often close to a shallow swimming area, further nurtures a sense of safe, free space in which children can wander. These features of childhood on Rossel Island support extended independent play with other children from an early age and may help explain the strongly increasing presence of child TCDS in the present data. Further work combining the time of day and interlocutor effects found here with ethnographic interview data are needed to explore these ideas in full. Overall, we see that children’s linguistic input shifts in the first three years, with proportionally more speech coming from less mature talkers; how this influences their early linguistic development, particularly given the minimal overall rate of TCDS, is open to further research.

## Trade-offs in the use of Panoramic methods
The present study used Panoramic methods to get a broader view of 10 Rossel children's linguistic landscapes, but was limited in both the number of children represented and the number of annotated minutes analyzed per child. The data presented here, though transcribed, were only analyzed for superficial features of children's linguistic environment: input rates of directed and overhearable speech and children's vocal maturity. A Close Study approach is needed in order to make semantically rich interpretations of what children are saying and hearing or to delineate cross-cultural differences in the content or style of child-directed speech.

While our Panoramic approach effectively captured circumstantial variation over the course of a waking day, it did _not_ completely avoid the Observer's Paradox [@labov1972sociolinguistic]; upon transcribing the data we found both moments when the speakers seemed to ignore the recorder and moments when it was the focus of discussion. The latter case often arose when new interactants came into contact with the child—a relatively frequent event—prompting the caregiver to explain and warn about the devices. There was also at least one case when a mother reported that the father, who is typically at home, avoided our recorder by spending the entire day elsewhere. Daylong methods then may decrease the intensity and continuity of the Observer’s Paradox, but do not eliminate it entirely. With this in mind, close ethnographic work over a longer period with a handful of families may, in fact, be the optimal way to minimize these effects. However, this approach severely limits the possible sample size of a study. What, then, is the ideal approach for exploring the variable linguistic environments in which children are raised?

When it comes to drawing inferences about the deeper forces shaping caregiver-child interaction and how they vary across cultures or, for that matter, any other task that requires researchers to grapple with what is actually _meant_ during interaction, a Close Study approach is the only real option. Even when applying a microanalytic approach to short clips derived from daylong recordings, the researcher likely will lack sufficient visual and interactional context to adequately reconstruct the scene. In this use case, short recordings maintain an advantage, particularly when Observer Paradox effects can be reduced by investing significant time with each observed family (e.g., over a high-density longitudinal study).

However, when it comes to quantifying the use of linguistic features in order to explore the feasibility of specific learning mechanisms (e.g., CDS as a facilitatory context for referential word learning), daylong data are crucial for establishing the frequency and circumstances under which the critical linguistic or interactional "data" are encountered. Given our present findings and those of @casillas2019early, studies focused on particular linguistic features of CDS (e.g., relative use of certain syntactic structures) may benefit from focusing annotation time on interactional peaks---where these features are much more likely to be on display---with less time dedicated to establishing a baseline estimate of CDS frequency (see also @bergelson2019day). Importantly, researchers making daylong recordings in a context where they are a cultural outsider should always do their recording collection in parallel with or following some ethnographic work to avoid the serious and potentially harmful pitfalls discussed in the Introduction (see also @cychoszURlongform).

We propose that the most promising long-term approach for using input patterns to test the feasibility of individual learning mechanisms is to strategically sub-sample daylong recordings made with a representative participant sample of the community studied, while maintaining comparable speech environment measures across communities whenever possible. This approach is suitable for tracking variation among related but distinct ethnolinguistic populations, which can help disentangle input and development effects related to the specific linguistic and cultural context in which each child is raised  (as proposed by Pye [-@pye2017comparative]; or a diversity-centric approach, as in @moran2016acqdiv), maintaining comparable speech environment measures whenever possible. The current study pales in comparison to this ideal, but hope to see this vision realized in future work.

## Conclusion {#disc-conclusion}
We estimate that, on average, children on Rossel Island under age 3;0 hear `r round(mean(quantity.rand.bychild$tds_mph),2)` minutes of directed speech per hour, with an average of `r round(mean(subset(quantity.nonrand.bychild, sample == "turn-taking")$tds_mph),2)` minutes per hour during peak interactive moments during the day. Most of directed speech comes from adults, but older children hear more directed speech from other children. There is also an average `r round(mean(quantity.rand.bychild$ods_mph),2)` minutes per hour of overhearable speech present. Older children heard more directed speech and less overhearable speech than younger children. Bursts of speech featuring mostly TCDS appear to be present from infancy onward. Despite this relatively low rate of directed speech, these children's vocal maturity appears on-track with norms for typically developing children in multiple diverse populations [@cychoszURcanonical; @lee2018babbling; @warlaumont2014social].

Our findings diverged in several ways from expectations developed on the basis of prior ethnographic work in this community, including the frequency of child-directed talk, the diversity of talkers, and the distribution of talk over the course of the day. When considered together with data from a Mayan community, the findings suggest that the Panoramic approach, while well suited to gathering inclusive, ecologically valid estimates of how much linguistic input children hear, is also far more sensitive to circumstantial variation (e.g., the number of speakers present) than it is to established ideological variation in how caregivers talk to children. For the latter, a Close Study or other hybrid approach is needed (e.g., analyzing content in interactional peaks). Whether child language development is better predicted by meaningful individual differences in average circumstantial variation (e.g., Panoramic input quantity), ideologically-based variation (e.g., attitudes toward language pedagogy), or something inbetween is a question for future work. Cross-cultural and cross-linguistic data will have a major role to play in teasing out the causal factors at play in this larger issue relating children's early linguistic experience to their later language development.

Importantly, the data presented here come from an evolving corpus of Yélî Dnye developmental data; any reader interested in citing descriptive features of the Rossel child language environment is strongly encouraged to visit the following address for up-to-date estimates: URL_MASKED_FOR_REVIEW<!--https://middycasillas.shinyapps.io/Yeli_Child_Language_Environment/-->. The information on that linked page will include any new data, annotations, and analyses added after the publication of this study.

# Acknowledgements {#acknowledgements}
<MASKED FOR REVIEW>
<!--The collection and annotation of these recordings was made possible by Taakêmê Ńamono, Ndapw:éé Yidika, and Y:aaw:aa Pikuwa; with thanks also to the PNG National Research Institute, and the Administration of Milne Bay Province. We thank and acknowledge the participating families and the Rossel community at large for their continuing support. We also acknowledge support from the ACLEW project and thank Maartje Weenink for her help with manual clip selection. This work is supported by a NWO Veni Innovational Scheme grant (275-89-033) to MC, an ERC Advanced Grant (269484 INTERACT) to SCL, and fieldwork funding from the Max Planck Institute for Psycholinguistics. This paper was written using the papaja library in RStudio [@R-papaja].-->


\newpage

# References {#refs}

```{r create_r-references}
r_refs(file = "Yeli-CLE.bib")
```

\begingroup
\setlength{\parindent}{-0.5in}
\setlength{\leftskip}{0.5in}

<div id = "refs"></div>
\endgroup
